<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <div th:replace="common/common :: common_resource"></div>
    <title>提现申请</title>
    <style type="text/css">
        .layui-layer-demo{
            background-color: #333333;
        }
    </style>
</head>

<body>
<!--列表-->
<div id="rapp">
    <div v-show="showList">
        <!-- shiro按钮权限示例:<p shiro:hasPermission="sys:menu">有权限</p> -->
        <fieldset class="layui-elem-field site-demo-button" style="margin-top: 10px;">
            <!-- 		    <button shiro:hasPermission="sys:menu" class="layui-btn layui-btn-primary" @click="add"><i class="layui-icon layui-icon-add-1"></i>新增</button> -->
            <div class="layui-input-inline" style="width:300px;">
                <form class="layui-form">
                    <label class="layui-form-label">申请状态</label>
                    <div class="layui-input-block">
                        <select name="invoice_status" lay-filter="invoice_status">
                            <option value="0" selected="">全部</option>
                            <option value="1">审核中</option>
                            <option value="2">已拒绝</option>
                            <option value="3">已通过</option>
                        </select>
                    </div>
                </form>
            </div>
        </fieldset>
        <table class="layui-table" lay-filter="test">
            <thead>
            <tr>
                <th>编号</th>
                <th>申请时间</th>
                <th>申请金额</th>
                <th>用户编号</th>
                <th>用户姓名</th>
                <th>申请状态</th>
                <th>收款方式</th>
                <th>提现方式</th>
                <th>申请备注</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            <tr v-for="(item,index) in data">
                <td>{{item.withdrawal_apply_id}}</td>
                <td>{{formatDateTimeStr(item.apply_add_date,1)}}</td>
                <td>{{item.apply_value}}</td>
                <td>{{item.user_basics_id}}</td>
                <td>{{item.receive_name}}</td>
                <td>{{item.apply_status}}</td>
                <td>{{item.apply_receipt_supplement}}</td>
                <td>余额提现</td>
                <td>{{item.apply_postscript}}</td>
                <td>
                    <a class="layui-btn layui-btn-xs" lay-event="jichufapiao" @click='jichufapiao(item.withdrawal_apply_id)'><i class="layui-icon layui-icon-notice"></i>打款</a>
                    <!-- 						<a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="dayingfapiao" @click='dayingfapiao(item.invoice_id)'><i class="layui-icon layui-icon-release"></i>打印发票</a> -->
                </td>
            </tr>
            </tbody>
        </table>
        <!--分页容器-->
        <div id="pagination"></div>
    </div>
</div>
<script type="text/javascript">
    //使用layui分页参数
    var pageIndex = 1;
    var pageSize = 10;
    var totalCount = 0;
    //初始化vue对象
    var vm = new Vue({
        el: "#rapp",
        data: {
            data: null,
            showList: true,
            title: null,
            invoice: {}
        },
        methods: {
            jichufapiao: function () {
                var param = {
                    withdrawal_apply_id: withdrawal_apply_id
                    //其它查询条件可在下面添加
                };
                $.ajax({
                    type: 'POST',
                    url: basePath+'/rePayController/toRePay',
                    dataType: 'json',
                    data: param,
                    async: false,//这里设置为同步执行，目的是等数据加载完再调用layui分页组件，不然分页组件拿不到totalCount的值
                    success: function (data) {
                        alert(data.message);
                    }
                });
            },

        }
    });
    pagination(pageIndex,pageSize);
    layui.use(['laypage','table','form'], function(){
        var table = layui.table, //表格
            laypage = layui.laypage,
            form = layui.form
        laypage.render({
            elem: 'pagination'
            , count: totalCount
            , layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
            , jump: function (obj, first) {
                //点击非第一页页码时的处理逻辑。比如这里调用了ajax方法，异步获取分页数据
                if (!first) {
                    pagination(obj.curr, obj.limit);//第二个参数不能用变量pageSize，因为当切换每页大小的时候会出问题
                    pageIndex = obj.curr;
                    pageSize = obj.limit;
                }
            },

        });
        //layui下拉框选择事件
        form.on('select(invoice_status)', function(data){
            pagination(pageIndex,pageSize,data.value);
        });

    });
    function pagination(pageIndex,pageSize,apply_status){
        //查询条件
        var param = {
            pageIndex: pageIndex,
            pageSize: pageSize,
            apply_status: apply_status
            //其它查询条件可在下面添加
        };
        $.ajax({
            type: 'POST',
            url: basePath+'/admin_bonus/adminFindIntegr',
            dataType: 'json',
            data: param,
            async: false,//这里设置为同步执行，目的是等数据加载完再调用layui分页组件，不然分页组件拿不到totalCount的值
            success: function (data) {
                vm.data = data.data.list;
                totalCount = data.data.total;
            }
        });
    };
</script>
</body>
</html>
