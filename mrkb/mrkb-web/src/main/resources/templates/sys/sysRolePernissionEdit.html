<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
<div th:replace="common/common :: common_resource"></div>
    <meta charset="utf-8">
    <title>角色菜单权限编辑</title>
    <script th:src="@{/js/layui-xtree.js}"></script>
</head>
  
<body>
    <form class="layui-form">
        <div id="xtree1" class="xtree_contianer"></div>
   </form>
<script type="text/javascript">
	var role_id=[[${role_id}]];
	var json=[];
	$(function(){
		$.get(basePath+"/sysMenu/getMenuListTree/"+role_id,function(data) {
			json=data.data
			for(var i=0; i<json.length;i++){
				for(var k=0;k<json[i].data.length;k++){
					if(json[i].data[k].checked=="true"){
						json[i].data[k].checked=true;
					}else{
						json[i].data[k].checked=false;
					}
				}
			}
			//layui 的 form 模块是必须的
			layui.use(['form'], function () {
		   		var form = layui.form;
		   		//1、最基础的用法 - 直接绑定json
		   		var xtree1 = new layuiXtree({
		       		elem: 'xtree1'   //(必填) 放置xtree的容器，样式参照 .xtree_contianer
		       		, form: form     //(必填) layui 的 from
		       		, data: json//(必填) json数据
// 		       		,isopen: false
		            , click: function (data) {  //节点选中状态改变事件监听，全选框有自己的监听事件
		            	var msg=layer.msg('加载中', {icon: 16,shade: 0.01});
		                if(data.elem.checked){//开关是否开启，true或者false
		                	$.post(basePath+"/sysMenu/roleMeunDistribution/"+role_id+"/"+data.elem.title+"/"+data.value, function(data) {
		                		layer.close(msg);
		                		layer.msg(data.message);
		                	});
// 							var oCks = xtree1.GetChecked();
// 							var values="";
// 							for (var i = 0; i < oCks.length; i++) {
// 				                console.log(oCks[i].value);
// 				                values+=oCks[i].value+",";
// 				            }
// 			                values = values.substr(0,values.length - 1);
		                }else{
		                	$.post(basePath+"/sysMenu/removePermission/"+data.value, function(data) {
		                		layer.close(msg);
		                		layer.msg(data.message);
		                	});
		                }
		            }
		   		});
			});
		})
	})
	
</script>
</body>
</html>
