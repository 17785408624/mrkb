<html xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:replace="common/common :: common_resource"></div>
    <meta charset="utf-8">
    <title>我的顾问</title>
    <style type="text/css">
        .uploader-list {
            margin-left: -15px;
        }

        .uploader-list .info {
            position: relative;
            margin-top: -25px;
            background-color: black;
            color: white;
            filter: alpha(Opacity = 80);
            -moz-opacity: 0.5;
            opacity: 0.5;
            width: 100px;
            height: 25px;
            text-align: center;
            display: none;
        }

        .uploader-list .handle {
            position: relative;
            background-color: black;
            color: white;
            filter: alpha(Opacity = 80);
            -moz-opacity: 0.5;
            opacity: 0.5;
            width: 100px;
            text-align: right;
            height: 18px;
            margin-bottom: -18px;
            display: none;
        }

        .uploader-list .handle span {
            margin-right: 5px;
        }

        .uploader-list .handle span:hover {
            cursor: pointer;
        }

        .uploader-list .file-iteme {
            margin: 12px 0 0 15px;
            padding: 1px;
            float: left;
        }
    </style>
</head>
<body>
<!--列表-->
<div id="vueContainer">
    <div v-show="showList">
        <fieldset class="layui-elem-field site-demo-button"
                  style="margin-top: 30px;">
            <div>
                <button class="layui-btn" @click="add">
                    <i class="layui-icon layui-icon-add-1"></i>新增
                </button>
            </div>
        </fieldset>
        <table class="layui-table" lay-filter="test">
            <thead>
            <tr>
                <th>编号</th>
                <th>用户编号</th>
                <th>经理姓名</th>
                <th>经理电话</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            <tr v-for="item in data">
                <td>{{item.consult_service_id}}</td>
                <td>{{item.user_basics_id}}</td>
                <td>{{item.senior_manager_name}}</td>
                <td>{{item.senior_manager_phone}}</td>
                <td><a class="layui-btn layui-btn-xs" lay-event="edit"
                       @click='edit(item.user_basics_id)'>编辑</a>
            </tr>
            </tbody>
        </table>
    </div>
    <!-- 新增面板 -->
    <div v-show="!showList" class="layui-card">
        <div class="layui-card-header">{{title}}</div>
        <div class="layui-card-body">
            <form class="layui-form">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">用户编号</label>
                        <div class="layui-input-block" style="width: 300px;">
                            <input type="text" name="user_basics_id" id="user_basics_id"
                                   v-model="UserInformationEntity.user_basics_id"
                                   placeholder="请输入用户编号" autocomplete="off" class="layui-input">

                        </div>
                    </div>
                    <div class="layui-inline">
                        <button type="button" onclick="findUserInformationOne();"
                                class="layui-btn layui-btn-normal">
                            <i class="layui-icon layui-icon-fonts-clear"></i>查询
                        </button>
                    </div>
                </div>
                <div class="layui-form-item" id="name">
                    <label class="layui-form-label">姓名</label>
                    <div class="layui-input-block">
                        <input type="text" name="information_compellation"
                               id="information_compellation"
                               v-model="UserInformationEntity.information_compellation"
                               placeholder="" readonly="readonly" autocomplete="off"
                               class="layui-input">
                    </div>

                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">经理姓名</label>
                        <div class="layui-input-block">
                            <input type="text" name="senior_manager_name"
                                   id="senior_manager_name"
                                   v-model="UserInformationEntity.senior_manager_name "
                                   placeholder="请输入高级经理姓名" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">经理电话</label>
                        <div class="layui-input-block">
                            <input type="text" name="senior_manager_phone"
                                   id="senior_manager_phone"
                                   v-model="UserInformationEntity.senior_manager_phone "
                                   placeholder="请输入高级经理电话" autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button type="button" class="layui-btn layui-btn-primary"
                                @click="save">
                            <i class="layui-icon layui-icon-ok"></i>提交
                        </button>
                        <button type="reset" class="layui-btn layui-btn-primary">
                            <i class="layui-icon layui-icon-refresh-3"></i>重置
                        </button>
                        <button class="layui-btn layui-btn-primary" @click="reload">
                            <i class="layui-icon layui-icon-return"></i>返回
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript">
    var active = {};
    $(function() {
        pagination();
    });
    layui.use([ 'laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element', 'slider', 'form', 'layedit' ], function() {
        var laydate = layui.laypage,
            layer = layui.layer, //弹层
            table = layui.table, //表格
            carousel = layui.carousel, //轮播
            upload = layui.upload, //上传
            element = layui.element, //元素操作
            slider = layui.slider, //滑块
            form = layui.form,
            laypage = layui.laypage,
            layedit = layui.layedit,
            $ = layui.jquery;
        form.on('select(user_grade_id)', function($event) { //绑定商品类型下拉框value的 值，判断下拉框是否显示

        });
        //富文本图片上传
        layedit.set({
            uploadImage : {
                url : basePath + '/layuiupload/uploadNewsImg', //接口url
                type : 'post' //默认post
            }
        });
        var index = layedit.build('editor');
        //编辑器外部操作
        active = {
            content : function() {
                return layedit.getContent(index);
                alert(layedit.getContent(index)); //获取编辑器内容
            },
            text : function() {
                alert(layedit.getText(index)); //获取编辑器纯文本内容
            },
            selection : function() {
                alert(layedit.getSelection(index));
            },
            setNews : function() {
                //alert(12);
                layedit.setContent(index, vue.news.detail_content);
            }
        };
        $('.site-demo-layedit').on('click', function() {
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });


    });
    var vue = new Vue({
        el : "#vueContainer",
        data : {
            data : null,
            showList : true,
            title : null,
            UserInformationEntity : {},
        },
        methods : {
            add : function() {
                vue.UserInformationEntity = {};
                vue.showList = false;
                vue.title = "新增";
                //初始化输入框或者选择框
                vue.UserInformationEntity = {
                    //例如
                    /* course_type : 0, //将value值初始化
                    academic_type : 0, //将value值初始化
                    user_grade_id : 0, //将value值初始化
                    store_type : 0 //将value值初始化 */
                };
            },
            save : function() {
                /**新增*/
                alert(JSON.stringify(vue.UserInformationEntity));
                vue.UserInformationEntity.user_basics_id = $("#user_basics_id").val();
                vue.UserInformationEntity.advisor_user_basics_id = $("#advisor_user_basics_id").val();
                vue.UserInformationEntity.seniorManager_user_basics_id = $("#seniorManager_user_basics_id").val();
                //alert(JSON.stringify(vue.UserInformationEntity));
                if (vue.UserInformationEntity.user_basics_id == null || vue.UserInformationEntity.user_basics_id <= 0) {
                    layer.tips('请输入用户编号', '#user_basics_id', {
                        tips : [ 3, '#0FA6D8' ] //还可配置颜色
                    });
                    return;
                }
                /**定义是新增还是修改*/
                var url = "/admin_userInfo/adminAddUserConsultService";

                $.ajax({
                    type : "POST",
                    url : basePath + url,
                    contentType : 'application/json',
                    async : true,
                    data : JSON.stringify(vue.UserInformationEntity),
                    success : function(rs) {
                        if (rs.errorCode == 200) {
                            layer.msg(rs.message);
                            vue.reload();
                        } else {
                            layer.msg(rs.message);
                        }
                    }
                });
            },
            //修改查询数据
            edit : function(id) {
                vue.UserInformationEntity = {};
                vue.showList = false;
                vue.title = "编辑";
                //下拉框查询
                //this.getselectoptions();
                $.ajax({
                    type : "GET",
                    url : basePath + "/admin_userInfo/getByUserConsultServiceId/" + id,
                    async : true,
                    success : function(r) {
                        vue.UserInformationEntity = r.data;
                    },
                    error : function(r) {
                        layer.msg(r.data.message);
                    }
                });
            },

            reload : function(event) {
                vue.showList = true;
            }
        }
    });
    var pageIndex = 1;
    var pageSize = 10;
    var totalCount = 0;
    pagination(pageIndex, pageSize);
    function pagination(pageIndex, pageSize) {
        var param = {
            pageIndex : pageIndex,
            pageSize : pageSize
        };
        $.ajax({
            type : 'POST',
            url : basePath + '/admin_userInfo/findAllUserConsultService/'+ pageIndex + "/" + pageSize,
            dataType : 'json',
            data : param,
            async : false, //这里设置为同步执行，目的是等数据加载完再调用layui分页组件，不然分页组件拿不到totalCount的值
            success : function(data) {
                vue.data = data.data.list;
                totalCount = data.data.total;
            }
        });
    }
    ;
</script>
<script type="text/javascript">
    /*用户查询*/
    function findUserInformationOne() {
        var user_basics_id = $("#user_basics_id").val();
        $.ajax({
            type : "GET",
            url : basePath + '/admin_userInfo/findUserInformOne',
            contentType : 'application/json',
            async : true,
            data : {
                user_basics_id : user_basics_id
            },
            success : function(rs) {
                ifname(rs);
            },
            error : function(r) {
                layer.msg(r.message);
            }
        });
    }
    ;
    function ifname(rs) {
        if (rs != null) {
            if (rs.data != null) {
                var information_compellation = rs.data.information_compellation;
                $("#information_compellation").val(information_compellation);
                //$("#name").show();
            } else {
                $("#user_basics_id").val("");
                alert("该用户未实名认证!");
            }
        } else {
            $("#user_basics_id").val("");
            alert("无该用户!");
        }
    }
    ;




    var path = ""; //图片路径保存
    /*图片上传*/
    layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element','form','slider'], function(){
        var laydate = layui.laypage,
            layer = layui.layer, //弹层
            table = layui.table, //表格
            carousel = layui.carousel, //轮播
            upload = layui.upload, //上传
            element = layui.element, //元素操作
            slider = layui.slider, //滑块
            form = layui.form,
            laypage = layui.laypage
        //执行实例
        var uploadInst = upload.render({
            elem : '#upload', //绑定元素
            multiple : true,
            exts : 'jpg|png|jpeg',
            size : 2048, //限制文件大小，单位 KB
            url : basePath + '/layuiupload/uploadNewsImg', //上传接口
            before : function(obj) {
                /*layer.close(layer.msg());//关闭上传提示窗口
                 */ //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result) {
                    $('#uploader-list').append(
                        '<div id="" class="file-iteme">' +
                        '<div class="handle"><span class="glyphicon glyphicon-trash"></span></div>' +
                        '<img style="width: 100px;height: 100px;" src=' + result + '>' +
                        '<div class="info">' + file.name + '</div>' +
                        '</div>'
                    );

                    //$('#uploader-list').append('<img  src="' + result + '" alt="' + file.name + 'style="width: 10px;height: 10px;"' + '" class="layui-upload-img">')
                });

                //layer.close(layer.msg()); //关闭上传提示窗口
                layer.msg('图片上传中...', {
                    icon : 16,
                    shade : 0.01,
                    time : 30
                })
            },

            done : function(res) {
                layer.close(layer.msg()); //关闭上传提示窗口
                //上传完毕回调
                path += res.data.src + ";";

                vue.UserInformationEntity.consult_picture = path;
                //alert("上传成功！");
            },
            error : function() {
                layer.msg('上传错误！');
                //请求异常回调
            }
        });
        //layui下拉框选择事件
        form.on('select(news_type_serch)', function(data){
            //alert(11);
            console.log(data.elem); //得到select原始DOM对象
            console.log(data.value); //得到被选中的值
            console.log(data.othis); //得到美化后的DOM对象
            pagination(pageIndex,pageSize,data.value)
        });
    });
    //鼠标悬浮提示
    $(document).on("mouseenter mouseleave", ".file-iteme", function(event) {
        if (event.type === "mouseenter") {
            //鼠标悬浮
            $(this).children(".info").fadeIn("fast");
            $(this).children(".handle").fadeIn("fast");
        } else if (event.type === "mouseleave") {
            //鼠标离开
            $(this).children(".info").hide();
            $(this).children(".handle").hide();
        }
    });

    // 删除图片
    $(document).on("click", ".file-iteme .handle", function(event) {
        $(this).parent().remove();
    });
</script>

</body>
</html>
