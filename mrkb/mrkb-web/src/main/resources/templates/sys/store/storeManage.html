<html xmlns:th="http://www.thymeleaf.org">
<head>
	<div th:replace="common/common :: common_resource"></div>
	<meta charset="utf-8">
	<title>商品管理</title>
	<style type="text/css">
		.uploader-list {
			margin-left: -15px;
		}

		.uploader-list .info {
			position: relative;
			margin-top: -25px;
			background-color: black;
			color: white;
			filter: alpha(Opacity = 80);
			-moz-opacity: 0.5;
			opacity: 0.5;
			width: 100px;
			height: 25px;
			text-align: center;
			display: none;
		}

		.uploader-list .handle {
			position: relative;
			background-color: black;
			color: white;
			filter: alpha(Opacity = 80);
			-moz-opacity: 0.5;
			opacity: 0.5;
			width: 100px;
			text-align: right;
			height: 18px;
			margin-bottom: -18px;
			display: none;
		}

		.uploader-list .handle span {
			margin-right: 5px;
		}

		.uploader-list .handle span:hover {
			cursor: pointer;
		}

		.uploader-list .file-iteme {
			margin: 12px 0 0 15px;
			padding: 1px;
			float: left;
		}
	</style>
</head>
<body>
<!--列表-->
<div id="vueContainer">
	<div v-show="showList">
		<fieldset class="layui-elem-field site-demo-button"
				  style="margin-top: 30px;">
			<div class="layui-input-inline">
				<button class="layui-btn" @click="add">
					<i class="layui-icon layui-icon-add-1"></i>新增
				</button>
			</div>
			<div class="layui-input-inline" style="width:200px;">
				<input type="text" id="search_store_name" placeholder="请输入商品名搜索"
					   autocomplete="off" class="layui-input">
			</div>
			<div id="search_btn" class="layui-input-inline" style="width:200px;">
				<button class="layui-btn layui-btn-primary" @click="serch">
					<i class="layui-icon layui-icon-search"></i>搜索
				</button>
			</div>

			<div class="layui-input-inline" style="width:200px; ">
				<form class="layui-form">
					<label class="layui-form-label">类型</label>
					<div class="layui-input-block" style="width:190px;">
						<select name="shelf_state" lay-filter="shelf_state"
								id="shelf_state">
							<option value="0">全部</option>
							<option value="1">上架</option>
							<option value="2">下架</option>
						</select>
					</div>
				</form>
			</div>
		</fieldset>
		<table class="layui-hide" lay-filter="test" id="data_export">

		</table>
		<!--分页容器-->
		<div id="pagination"></div>
	</div>
	<!-- 新增面板 -->
	<div v-show="!showList" class="layui-card">
		<div class="layui-card-header">{{title}}</div>
		<div class="layui-card-body">
			<form class="layui-form">
				<div class="layui-form-item">
					<label class="layui-form-label">商品名</label>
					<div class="layui-input-block">
						<input type="text" name="store_name" id="store_name"
							   v-model="store.store_name" placeholder="请输入商品名"
							   autocomplete="off" class="layui-input">
					</div>
				</div>
                <div class="layui-form-item">
                    <label class="layui-form-label">商家编号</label>
                    <div class="layui-input-block">
                        <input type="text" name="business_id" id="business_id"
                               v-model="store.business_id" placeholder="请输入商家编号"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">利润</label>
                    <div class="layui-input-block">
                        <input type="text" name="profit_monry" id="profit_monry"
                               v-model="store.profit_monry" placeholder="请输入利润"
                               autocomplete="off" class="layui-input">
                    </div>
                </div>
				<div class="layui-form-item">
					<label class="layui-form-label">商品价格</label>
					<div class="layui-input-block">
						<input type="text" id="store_price" name="store_price"
							   v-model="store.store_price" placeholder="请输入商品价格"
							   autocomplete="off" class="layui-input">
					</div>
				</div>

				<div class="layui-form-item" id="storeDiv">
					<label class="layui-form-label">商品类型</label>
					<div class="layui-input-block" id="selectStore">
						<select name="store_type" id="store_type"
								v-model="store.store_type" lay-filter="store_type">
							<option value=""></option>
							<option value="0">普通商城</option>
							<option value="1">返利商城</option>
						</select>
					</div>
				</div>


				<div class="layui-form-item" id="userGradeDiv">
					<label class="layui-form-label">会员等级</label>
					<div class="layui-input-block" id="selectUserGrade">
						<select name="user_grade_id" id="user_grade_id"
								v-model="store.user_grade_id" lay-filter="user_grade_id">
							<option value="0"></option>
							<option value="1">普通会员</option>
							<option value="2">白银</option>
							<option value="3">黄金</option>
							<option value="4">白金</option>
						</select>
					</div>
				</div>

				<div class="layui-form-item">
					<label class="layui-form-label">商品单位</label>
					<div class="layui-input-block">
						<input type="text" name="store_unit" id="store_unit"
							   v-model="store.store_unit" placeholder="请输入商品单位"
							   autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item">
					<label class="layui-form-label">其他费用</label>
					<div class="layui-input-block">
						<input type="text" name="other_price" id="other_price"
							   v-model="store.other_price" placeholder="请输入其他费用"
							   autocomplete="off" class="layui-input">
					</div>
				</div>

				<div class="layui-form-item" id="all_ids">

					 
				</div>

				<div class="layui-form-item">
					<!-- 				    <label class="layui-form-label">图片</label>
-->
					<div class="layui-input-block">
						<input type="hidden" name="store_picture"
							   v-model="store.store_picture" placeholder="请上传图片"
							   autocomplete="off" class="layui-input">
					</div>
					<div class="layui-upload">
						<button type="button" class="layui-btn" id="upload">图片上传</button>
						<blockquote class="layui-elem-quote layui-quote-nm"
									style="margin-top: 10px;width: 88%">
							预览图：
							<div class="layui-upload-list uploader-list"
								 style="overflow: auto;" id="uploader-list"></div>
						</blockquote>
					</div>
				</div>
				<textarea class="layui-textarea" id="editor" style="display: none"
						  lay-verify="content"> </textarea>
				<!-- <li class="clearfix"><label class="label_name col-xs-1"><i></i>内容介绍：&nbsp;&nbsp;</label>
                    <div class="Add_content col-xs-11"><script id="editor" type="text/plain" style="width:100%;height:500px;"></script></div>
                 </li>  -->

				<div class="layui-form-item">
					<div class="layui-input-block">
						<button type="button" class="layui-btn layui-btn-primary"
								@click="save">
							<i class="layui-icon layui-icon-ok"></i>提交
						</button>
						<button type="reset" class="layui-btn layui-btn-primary">
							<i class="layui-icon layui-icon-refresh-3"></i>重置
						</button>
						<button class="layui-btn layui-btn-primary" @click="reload">
							<i class="layui-icon layui-icon-return"></i>返回
						</button>
					</div>
				</div>
			</form>
		</div>
	</div>
</div>
<script type="text/javascript" th:inline="none">
    var active = {};
    //var storeId ="";
    layui.use([ 'laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element', 'slider', 'form', 'layedit' ], function() {
        var laydate = layui.laypage,
            layer = layui.layer, //弹层
            table = layui.table, //表格
            carousel = layui.carousel, //轮播
            upload = layui.upload, //上传
            element = layui.element, //元素操作
            slider = layui.slider, //滑块
            form = layui.form,
            laypage = layui.laypage,
            layedit = layui.layedit,
            $ = layui.jquery;

        form.on('select(store_type)', function($event) { //绑定商品类型下拉框value的 值，判断下拉框是否显示
            var val = $event.value;
            if (val == 1) { //判断商品类型不是定制商品类型
                $("#courseDiv").show();
                $("#academicDiv").show();
                $("#userGradeDiv").show();
                $("#isLetangDiv").show();
                //$("#isIntegralBeanDiv").show();//
                $("#isCourseBeanDiv").show();
            } else {
                $("#courseDiv").hide();
                $("#academicDiv").hide();
                $("#userGradeDiv").hide();
                $("#isLetangDiv").hide();
                //$("#isIntegralBeanDiv").hide();
                $("#isCourseBeanDiv").hide();
                $("#idsNum").hide();
            }
        });

        layedit.set({
            uploadImage : {
                url : basePath + '/layuiupload/uploadStoreImg', //接口url
                type : 'post' //默认post
            }
        });
        // 			form.verify({
        //             	content: function(value) {
        //                 	return layedit.sync(index);
        //             	}
        //         	});
        var index = layedit.build('editor');
        //编辑器外部操作
        active = {
            content : function() {
                return layedit.getContent(index);
                //alert(layedit.getContent(index)); //获取编辑器内容
            },
            text : function() {
                alert(layedit.getText(index)); //获取编辑器纯文本内容
            },
            selection : function() {
                alert(layedit.getSelection(index));
            },
            setStore : function() {
                layedit.setContent(index, vue.store.store_intro);
            }
        };
        $('.site-demo-layedit').on('click', function() {
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

    });
    var vue = new Vue({
        el : "#vueContainer",
        data : {
            data : null,
            showList : true,
            title : null,
            store : {},
        },
        methods : {
            add : function() {
                vue.store = {};
                vue.showList = false;
                vue.title = "新增";
                //初始化输入框或者选择框
                vue.store = {
                    //例如
                    /* course_type : 0, //将value值初始化
                    academic_type : 0, //将value值初始化
                    user_grade_id : 0, //将value值初始化
                    store_type : 0 //将value值初始化 */
                };
            },
            save : function() {
                var store_intro = active.content();
                var userGradeType = $("#user_grade_id").val(); //会员等级
                var storeName = $("#store_name").val(); //商品名称
                var business_id = $("#business_id").val(); //商家ID
                var profit_monry = $("#profit_monry").val(); //利润
                var store_type = $("#store_type").val(); //利润
                vue.store.user_grade_id = userGradeType; //设置会员等级类型初始值
                vue.store.store_intro = store_intro; //编辑器内容
                vue.store.store_name = storeName;
                vue.store.business_id=business_id;
                vue.store.profit_monry=profit_monry;
                vue.store.store_type=store_type;
                if (vue.store.store_name == null || vue.store.store_name.length <= 0) {
                    layer.tips('商品名不能为空', '#store_name', {
                        tips : [ 3, '#0FA6D8' ] //还可配置颜色
                    });
                    return;
                }
                if (vue.store.store_price == null || vue.store.store_price.length <= 0) {
                    layer.tips('商品价格不能为空', '#store_price', {
                        tips : [ 3, '#0FA6D8' ] //还可配置颜色
                    });
                    return;
                }
                if (vue.store.store_type == null || vue.store.store_type.length <= 0) {
                    layer.tips('商品类型不能为空', $('#selectStore').parent(), {
                        tips : [ 3, '#0FA6D8' ] //还可配置颜色
                    });
                    return;
                }


                if (vue.store.store_unit == null || vue.store.store_unit.length <= 0) {
                    layer.tips('商品单位不能为空', '#store_unit', {
                        tips : [ 3, '#0FA6D8' ] //还可配置颜色
                    });
                    return;
                }
                /*  if(vue.store.other_price == null || vue.store.other_price.length<=0){
                        layer.tips('其他费用不能为空', '#other_price', {
                                      tips: [3, '#0FA6D8'] //还可配置颜色
                                    });
                                    return;
                    }  */
                /**定义是新增还是修改*/
                    //console.log(JSON.stringify(vue.store));
                var url = vue.store.store_id == null ? "/store/storeAdd" : "/store/editStore";
                $.ajax({
                    type : "POST",
                    url : basePath + url,
                    contentType : 'application/json',
                    async : true,
                    data : JSON.stringify(vue.store),
                    success : function(r) {
                        if (r.errorCode == 200) {
                            layer.msg(r.message);
                            //vue.reload();
                            //window.history.back(-1);
                            window.location.href = basePath + "/store/storeManage";
                        } else {
                            layer.msg(r.message);
                        }
                    }
                });
            },
            //修改查询数据
            edit : function(id) {
                //alert(11);
                vue.store = {};
                vue.showList = false;
                vue.title = "编辑";
                //下拉框查询
                //this.getselectoptions();
                $.ajax({
                    type : "GET",
                    url : basePath + "/store/getByStoreId/" + id,
                    async : true,
                    success : function(r) {
                        vue.store = r.data;
                        if (vue.store.store_type == 1) { //判断商品类型不是定制商品类型
                            $("#courseDiv").show();
                            $("#academicDiv").show();
                            $("#userGradeDiv").show();
                            $("#isLetangDiv").show();
                            $("#isCourseBeanDiv").show();


                        } else {
                            $("#courseDiv").hide();
                            $("#academicDiv").hide();
                            $("#userGradeDiv").hide();
                            $("#isLetangDiv").hide();
                            $("#isCourseBeanDiv").hide();

                        }

                        /*回显图片pictures*/
                        var pictures = vue.store.store_picture.split(";");
                        for (var i = 0; i < pictures.length - 1; i++) {
                            $('#uploader-list').append(
                                '<div id="" class="file-iteme">' +
                                '<div class="handle"><span class="glyphicon glyphicon-trash"></span></div>' +
                                '<img style="width: 100px;height: 100px;" src=' + basePicturePath + pictures[i] + '>' +
                                '<div class="info">' + 'lll' + '</div>' +
                                '</div>');
                        }
                        active.setStore(); //给富文本编辑器赋值
                        /*商品类型下拉框禁用*/
                        $("#store_type").attr("disabled", "disabled");
                        var select0 = 'dd[lay-value=' + r.data.store_type + ']';
                        $('#store_type').siblings("div.layui-form-select").find('dl').find(select0).click();


                        /*会员等级下拉框禁用*/
                        var select3 = 'dd[lay-value=' + r.data.user_grade_id + ']';
                        $('#user_grade_id').siblings("div.layui-form-select").find('dl').find(select3).click();
                        $("#user_grade_id").attr("disabled", "disabled");


                        /*是否能用快乐豆兑换课程类型下拉框禁用*/
                        var select5 = 'dd[lay-value=' + r.data.is_integralBean + ']';
                        $('#is_integralBean').siblings("div.layui-form-select").find('dl').find(select5).click();
                        $("#is_integralBean").attr("disabled", "disabled");
                        layui.form.render('select');

                    },
                    error : function(r) {
                        layer.msg(r.data.message);
                    }
                });
            },
            //删除商品
            del : function(id) {
                layer.confirm('该商品已经上线，确定删除该商品？', {
                    btn : [ '确定', '取消' ] //按钮
                }, function() {
                    $.get(basePath + "/store/deleteStore/" + id, function(data) {
                        window.location.reload();
                       // layer.msg(data.message);
                       // vue.reload();
                    });
                }, function() {
                    layer.msg('取消操作', {
                        icon : 2
                    });
                });
            },
            //搜索
            serch : function() {
                var store_name = $("#search_store_name").val();

                pagination(1, 10, store_name);
            },

            reload : function() {
                //vue.showList = true;
                vue.serch();
                vue.showList = true;
            },
            isShelfStates : function(store_id, state) {
                vue.store.store_id = store_id;
                vue.store.shelf_state = state;
                if (state == 1) {
                    layer.confirm('该商品已经上线，确定下架该商品？', {
                        btn : [ '确定', '取消' ] //按钮
                    }, function() {
                        $.ajax({
                            type : "POST",
                            url : basePath + "/store/updateShelfState/",
                            contentType : 'application/json',
                            async : true,
                            data : JSON.stringify(vue.store),
                            success : function(r) {
                                if (r.errorCode == 200) {
                                    window.location.reload();
                                    //layer.msg(r.message);
                                    //vue.reload();
                                   // window.history.back(0);
                                } else {
                                    layer.msg(r.message);
                                }
                            }
                        });

                    }, function() {
                        layer.msg('取消操作', {
                            icon : 2
                        });
                    });

                } else if (state == 2) {
                    layer.confirm('该商品已经下线，确定上架该商品？', {
                        btn : [ '确定', '取消' ] //按钮
                    }, function() {
                        $.ajax({
                            type : "POST",
                            url : basePath + "/store/updateShelfState/",
                            contentType : 'application/json',
                            async : true,
                            data : JSON.stringify(vue.store),
                            success : function(r) {
                                if (r.errorCode == 200) {
                                    //layer.msg(r.message);
									window.location.reload();
                                    //vue.reload();
                                   // window.history.back(0);
                                } else {
                                    layer.msg(r.message);
                                }
                            }
                        });

                    }, function() {
                        layer.msg('取消操作', {
                            icon : 2
                        });
                    });
                }

            }
        }
    });
    //使用layui分页
    var pageIndex = 1;
    var pageSize = 10;
    var totalCount = 0;
    //pagination(pageIndex, pageSize);
    function pagination(pageIndex, pageSize, name) {
        //查询条件
        var param = {
            pageIndex : pageIndex,
            pageSize : pageSize,
            name : name
            //其它查询条件可在下面添加
        };
        $.ajax({
            type : 'POST',
            url : basePath + '/store/storeList/' + pageIndex + "/" + pageSize,
            dataType : 'json',
            data : param,
            async : true, //这里设置为同步执行，目的是等数据加载完再调用layui分页组件，不然分页组件拿不到totalCount的值
            success : function(data) {
                // console.log(data);
                vue.data = data.data.list;
                totalCount = data.data.total;
                //getPage();
            }
        });
    }
    ;


    var path = ""; //图片路径保存
    /*图片上传*/
    layui.use('upload', function() {
        var upload = layui.upload;
        //执行实例
        var uploadInst = upload.render({
            elem : '#upload', //绑定元素
            multiple : true,
            exts : 'jpg|png|jpeg',
            size : 10240, //限制文件大小，单位 KB
            url : basePath + '/layuiupload/uploadStoreImg', //上传接口
            before : function(obj) {
                /*layer.close(layer.msg());//关闭上传提示窗口
                 */ //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result) {
                    $('#uploader-list').append(
                        '<div id="" class="file-iteme">' +
                        '<div class="handle"><span class="glyphicon glyphicon-trash"></span></div>' +
                        '<img style="width: 100px;height: 100px;" src=' + result + '>' +
                        '<div class="info">' + file.name + '</div>' +
                        '</div>'
                    );

                    //$('#uploader-list').append('<img  src="' + result + '" alt="' + file.name + 'style="width: 10px;height: 10px;"' + '" class="layui-upload-img">')
                });

                //layer.close(layer.msg()); //关闭上传提示窗口
                layer.msg('图片上传中...', {
                    icon : 16,
                    shade : 0.01,
                    time : 30
                })
            },

            done : function(res) {
                layer.close(layer.msg()); //关闭上传提示窗口
                //上传完毕回调
                path += res.data.url + ";";
                vue.store.store_picture = path;
                //alert("上传成功！");
            },
            error : function() {
                layer.msg('上传错误！');
                //请求异常回调
            }
        });
    });
    //鼠标悬浮提示
    $(document).on("mouseenter mouseleave", ".file-iteme", function(event) {
        if (event.type === "mouseenter") {
            //鼠标悬浮
            $(this).children(".info").fadeIn("fast");
            $(this).children(".handle").fadeIn("fast");
        } else if (event.type === "mouseleave") {
            //鼠标离开
            $(this).children(".info").hide();
            $(this).children(".handle").hide();
        }
    });

    // 删除图片
    $(document).on("click", ".file-iteme .handle", function(event) {
        $(this).parent().remove();
    });
    //数据渲染
    layui.use([ 'table', 'layer', 'form', 'layer' ], function() {
        var isShelfState = 0;
        var name = "";
        var table = layui.table; //表格
        var form = layui.form; //表单
        var layer = layui.layer; //弹层
        var $ = layui.jquery;
        var exportData = " "; //定义全局导出数据变量
        table.render({ //数据渲染
            elem : '#data_export',
            url : basePath + '/store/storeList',
            limit : 10,
            //toolbar : true,
            loading : true,
            page : true,
            title : '商品数据表',
            where : {
                store_name : name,
                shelf_state : isShelfState,
            },
            cols : [ [
                /* {
                    type : 'checkbox'
                }, */
                {
                    field : 'store_id',
                    title : 'ID',
                    sort : true
                },
                {
                    field : 'store_name',
                    title : '商品名'
                },
                {
                    field : 'business_id',
                    title : '商家编号'
                },
                {
                    field : 'store_type',
                    title : '商品类型'
                },

                {
                    field : 'user_grade_id',
                    title : '可达会员等级'
                },
                {
                    field : 'store_price',
                    title : '商品价格'
                },
                {
                    field : 'store_unit',
                    title : '商品单位'
                },
                {
                    field : 'profit_monry',
                    title : '利润'
                },
                {
                    field : 'other_price',
                    title : '其他费用'
                },
                {
                    field : 'add_date',
                    title : '商品录入日期',
                    width : 240
                },
                {
                    field : 'shelf_state',
                    title : '是否上架'
                },
                {
                    fixed : 'right',
                    title : '操作',
                    //toolbar : '#barDemo',
                    width : 240,
                    templet:function(row){
                        //alert(row.shelf_state);
                        if(row.shelf_state == "是"){
                            return  '<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="isShelfStates" >下架</a>'+
                                '<a class="layui-btn layui-btn-xs" lay-event="edit" >编辑</a>'+
                                '<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>';
                        }else if(row.shelf_state == "否"){
                            return  '<a class="layui-btn layui-btn-xs" lay-event="isShelfStates" >上架</a>'+
                                '<a class="layui-btn layui-btn-xs" lay-event="edit" >编辑</a>'+
                                '<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>';
                        }
                    }
                }
            ] ],
            request : { //修改默认参数limit及page名称
                pageName : 'pageIndex',
                limitName : 'pageSize'
            },
            parseData : function(res) {
                var data = res.data.list;
                for (index in data) { //解决导出时间格式问题
                    var date = data[index].add_date;
                    var time = new Date(date);
                    data[index].add_date = formatDateTimeStr(data[index].add_date,1);
                    //data[index].add_date = time.getFullYear() + "-" + (time.getMonth() + 1) + "-" + time.getDate() + " " + time.getHours() + ":" + time.getMinutes() + ":" + time.getSeconds();
                }

                for (indexStoreType in data) { //商品课程类型
                    var store_type = data[indexStoreType].store_type;
                    if (store_type == 0) {
                        data[indexStoreType].store_type = "商城";
                    } else if (store_type == 1) {
                        data[indexStoreType].store_type = "返利商城";
                    } else if (store_type == 2) {
                        data[indexStoreType].store_type = "积分商城";
                    }
                }

                for (indexUserGradeId in data) { //会员等级类型
                    var user_grade_id = data[indexUserGradeId].user_grade_id;
                    if (user_grade_id == 1) {
                        data[indexUserGradeId].user_grade_id = "青铜会员";
                    } else if (user_grade_id == 2) {
                        data[indexUserGradeId].user_grade_id = "白银会员";
                    } else if (user_grade_id == 3) {
                        data[indexUserGradeId].user_grade_id = "黄金会员";
                    } else if (user_grade_id == 4) {
                        data[indexUserGradeId].user_grade_id = "钻石会员";
                    } else {
                        data[indexUserGradeId].user_grade_id = "--";
                    }
                }
                for (indexShelfState in data) { //商品是否下架类型
                    var shelf_state = data[indexShelfState].shelf_state;
                    //alert(shelf_state);
                    if (shelf_state == 1) {
                        data[indexShelfState].shelf_state = "是";
                        $("#isShelfStateId2").hide();
                        $("#isShelfStateId1").show();
                    } else if (shelf_state == 2) {
                        data[indexShelfState].shelf_state = "否";
                        $("#isShelfStateId1").hide();
                        $("#isShelfStateId2").show();
                    } else {
                        data[indexShelfState].shelf_state == "";
                    }
                }
                return { //返回数据
                    "code" : res.errorCode == 200 ? 0 : -1,
                    "msg" : res.message,
                    "count" : res.data.total,
                    data : res.data.list
                }

            },
            done : function(res, curr, count) {
                // console.log(res.data);
                exportData = res.data; //获取表格中的数据集合。
            }
        });
        //关键字搜索数据
        var $ = layui.$,
            active = {
                getCheckData : function() { //获取选中数据
                    var checkStatus = table.checkStatus('idTest'),
                        data = checkStatus.data;
                    layer.alert(JSON.stringify(data));
                },
                getCheckLength : function() { //获取选中数目
                    var checkStatus = table.checkStatus('idTest'),
                        data = checkStatus.data;
                    layer.msg('选中了：' + data.length + ' 个');
                },
                isAll : function() { //验证是否全选
                    var checkStatus = table.checkStatus('idTest');
                    layer.msg(checkStatus.isAll ? '全选' : '未全选')
                },
                reload : function() {
                    name = $("#search_store_name").val();

                    if (1) {
                        //console.log(1);
                        table.reload('data_export',
                            {
                                page : {
                                    curr : 1 //重新从第 1 页开始
                                },
                                where : {
                                    store_name : name,
                                    shelf_state : isShelfState,
                                }, //这里传参  向后台
                                url : basePath + '/store/storeList', //后台做模糊搜索接口路径
                                method : 'get'
                            });
                    }
                },
                selectReload : function() {
                    //var name =$("#shelf_state option:selected").val();
                    if (1) {
                        //console.log(isShelfState);
                        table.reload('data_export',
                            {
                                page : {
                                    curr : 1 //重新从第 1 页开始
                                },
                                where : {
                                    shelf_state : isShelfState,
                                    store_name :name,
                                }, //这里传参  向后台
                                url : basePath + '/store/storeList', //后台做模糊搜索接口路径
                                method : 'get'
                            });
                    }
                }
            };

        $('#search_btn').on('click', function() { //触发搜索事件，根据商品名称查询
            var type = 'reload';
            active[type] ? active[type].call(this) : '';
        });
        form.on('select(shelf_state)', function(data) { //根据下拉框状态值（shelf_state 是否下架（1上架，2下架）） 展示不同状态数据
            isShelfState = data.value;
            var type = 'selectReload';
            active[type] ? active[type].call(this) : '';

        });
        table.on('tool(test)', function(obj){//根据table监听编辑，删除操作
            var data = obj.data;
            if(obj.event === 'detail'){
                layer.msg('ID：'+ data.store_id + ' 的查看操作');
            } else if(obj.event === 'del'){
                vue.del(data.store_id);////跳转至vue的删除方法
            } else if(obj.event === 'edit'){
                vue.edit(data.store_id);//跳转至vue的编辑方法
                // layer.alert('编辑行：<br>'+ JSON.stringify(data))
            }else if(obj.event === 'isShelfStates'){
                //alert(data.shelf_state);
                var state ="";
                if(data.shelf_state=="是"){
                    state =1;
                    vue.isShelfStates(data.store_id,state);
                }else if(data.shelf_state=="否"){
                    state =2;
                    vue.isShelfStates(data.store_id,state);
                }
            }
        });

    });
</script>
</body>
</html>
