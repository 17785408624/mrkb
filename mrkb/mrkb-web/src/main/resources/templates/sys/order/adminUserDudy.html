<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
<div th:replace="common/common :: common_resource"></div>
    <title>当班</title>
    <style type="text/css">
    	.layui-layer-demo{
    		background-color: #333333;
    	}
    </style>
</head>
  
<body>
<!--列表-->
<div id="rapp">
    <div v-show="showList">
    	<!-- shiro按钮权限示例:<p shiro:hasPermission="sys:menu">有权限</p> -->
    	<fieldset class="layui-elem-field site-demo-button" style="margin-top: 10px;">
<!-- 		    <button shiro:hasPermission="sys:menu" class="layui-btn layui-btn-primary" @click="add"><i class="layui-icon layui-icon-add-1"></i>新增</button> -->
			<div class="layui-input-inline" style="width:300px;">
	           <form class="layui-form">
	           		<label class="layui-form-label">当班状态</label>
			    <div class="layui-input-block">
			      <select name="if_duty" lay-filter="if_duty">
			        <option value="0">未当班</option>
			        <option value="1">已当班</option>
			      </select>
			    </div>
	           </form>
	        </div>
		</fieldset>
	    <table class="layui-table" lay-filter="test">
	        <thead>
	            <tr>
	                <th>编号</th>
	                <th>用户编号</th>
					<th>用户姓名</th>
	                <th>订单编号</th>
	                <th>下单时间</th>
	                <th>当班时间</th>
	                <th>当班情况</th>
	                <th>操作</th>
	            </tr>
	        </thead>
	        <!--  @click='toduty(item.user_basics_id)' -->
	        <tbody>
	            <tr v-for="(item,index) in data">
	                <td>{{item.duty_id}}</td>
					<td>{{item.user_basics_id}}</td>
					<td>{{item.information_compellation}}</td>
	                <td>{{item.order_id}}</td>
	                <td>{{formatDateTimeStr(item.add_date,1)}}</td>
	                <td>{{formatDateTimeStr(item.duty_date,1)}}</td>
	                <td v-if="item.if_duty==0">未当班</td>
	                <td v-if="item.if_duty==1">已当班</td>
	                <td>
						<a v-if="item.if_duty==0" class="layui-btn layui-btn-xs" lay-event="edit" @click='toduty(item.duty_id,item.user_basics_id,item.order_id)'><i class="layui-icon layui-icon-notice"></i>当班</a>
	                </td>
	            </tr>
	        </tbody>
	    </table>
    	<!--分页容器-->
		<div id="pagination"></div>
    </div>
</div>
<script type="text/javascript">
		//使用layui分页参数
	    var pageIndex = 1;
		var pageSize = 10;
		var totalCount = 0;
		//初始化vue对象
		var vm = new Vue({
		    el: "#rapp",
		    data: {
		        data: null,
		        showList: true,
		        title: null,
		        UserDuty: {}
		    },
		     methods: {
		    	toduty: function (duty_id,user_basics_id,order_id) {
		          	//当班条件
				    var param = {
				        duty_id: duty_id,
				        user_basics_id: user_basics_id,
				        order_id:order_id
				        //其它查询条件可在下面添加
				    };
				    $.ajax({
				        type: 'POST',
				        url: basePath+'/admin_duty/dutyuser/',
				        dataType: 'json',
		                data: param,
				        async: false,//这里设置为同步执行，目的是等数据加载完再调用layui分页组件，不然分页组件拿不到totalCount的值
				        success: function (data) {
				            alert("当班成功！");
				        	console.log(data.data);
				            totalCount = data.data.total;
				        }
				    });
		        },
	        }
	    });
		pagination(pageIndex,pageSize);
		layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element','form','slider'], function(){
		    var laydate = layui.laypage,
		    layer = layui.layer, //弹层
		    table = layui.table, //表格
		    carousel = layui.carousel, //轮播
		    upload = layui.upload, //上传
		    element = layui.element, //元素操作
		    slider = layui.slider, //滑块
		    form = layui.form,
		    laypage = layui.laypage
		    laypage.render({
		        elem: 'pagination'
		        , count: totalCount
		        , layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
		        , jump: function (obj, first) {
		            //点击非第一页页码时的处理逻辑。比如这里调用了ajax方法，异步获取分页数据
		            if (!first) {
		                pagination(obj.curr, obj.limit);//第二个参数不能用变量pageSize，因为当切换每页大小的时候会出问题
		                //alert(obj.curr, obj.limit);
		                pageIndex = obj.curr;
						pageSize = obj.limit;
		            }
		        },
		        
		    });
		    //layui下拉框选择事件
		    form.on('select(if_duty)', function(data){
// 				console.log(data.elem); //得到select原始DOM对象
 				//console.log(data.value); //得到被选中的值
// 				console.log(data.othis); //得到美化后的DOM对象
				pagination(pageIndex,pageSize,data.value)
			});

		});
		function pagination(pageIndex,pageSize,if_duty){
			//查询条件
		    var param = {
		        pageIndex: pageIndex,
		        pageSize: pageSize,
		        if_duty: if_duty
		        //其它查询条件可在下面添加
		    };
		    $.ajax({
		        type: 'POST',
		        url: basePath+'/admin_duty/findUserDuty',
		        dataType: 'json',
                data: param,
		        async: false,//这里设置为同步执行，目的是等数据加载完再调用layui分页组件，不然分页组件拿不到totalCount的值
		        success: function (data) {
		        	//console.log(data.data.list);
					//alert(data.data.list);
		            vm.data = data.data.list;
		            totalCount = data.data.total;
		        }
		    });
		};
		//发货提交
		/* function saveFahuo(order_id){
			var courier_services_company=$("#fahuo_form input[name=courier_services_company]").val();
			if(courier_services_company.length<=0){
				layer.msg('请填写快递公司名称', {icon: 2});
				return;
			}
			var waybill_number=$("#fahuo_form input[name=waybill_number]").val();
			if(waybill_number.length<=0){
				layer.msg('请填写快递单号', {icon:2});
				return;
			}
        	$.ajax({
        		url:basePath+'/admin_order/sendStore',
        		contentType:'application/json',
        		type:'post',
        		data:JSON.stringify({order_id:order_id,courier_services_company:courier_services_company,waybill_number:waybill_number}),
        		success:function(data){
        			layer.msg(data.message, {icon:1});
        		},
        		error:function(){
        			layer.msg('请求异常', {icon:2});
        		}
        	})
		} */
</script>
</body>
</html>
