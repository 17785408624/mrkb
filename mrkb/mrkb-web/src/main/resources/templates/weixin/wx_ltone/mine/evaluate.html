<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<title>评价</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/weui.min.css" th:href="@{/css/wx_ltone/weui.min.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/jquery-weui.css" th:href="@{/css/wx_ltone/jquery-weui.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/reset.css" th:href="@{/css/wx_ltone/reset.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/mainstyle.css" th:href="@{/css/wx_ltone/mainstyle.css}" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/public.css" th:href="@{/css/wx_ltone/public.css}" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/evaluate.css" th:href="@{/css/wx_ltone/evaluate.css}"/>
	</head>
	<body>
		<div class="search">
			<div class="search-left">
				<a href="javascript:history.go(-1);">
					<img th:src="@{/img/wx_ltone/icon/mine/fanhui.png}">
				</a>
			</div>
		</div>
		<div class="mdfd-content">
			<!--退款-->
			<div class="outset-border">
				<!--订单信息-->
				<div class="evaluate border-b-8F8F94">
					<div class="order-detail">
						<div class="order-img">
							<img id="store_picture">
						</div>
						<div class="order-info">
							<h5 class="default-text-color" id="storeName"></h5>
							<p>
								<span class="float-l" id="price"></span>
							</p>
						</div>
					</div>
				</div>
				
				<!--评价内容-->
				<div class="evaluate">
					<!--输入文本域-->
					<textarea name="evaluate" id="evaluation_value" rows="5" placeholder="宝贝能满足你的期待么？说说你的使用心得，分享给想买的他们吧！！！"></textarea>
					<!--添加照片
					<div class="evaluate-img-box">
						<div class="img-box">
							<img src="file/jointly/images/banner/home/banner1.jpg"/>
						</div>
						<div class="img-box">
							<img src="file/jointly/images/banner/home/banner2.jpg"/>
						</div>
						<div class="img-box">
							<img src="file/jointly/images/banner/home/banner2.jpg"/>
						</div>
						<div class="img-box">
							<img src="file/jointly/images/banner/home/banner2.jpg"/>
						</div>
						<div id="camera" class="img-box">
							<img src="file/jointly/images/icon/icon-camera.png"/>
							<input id="takepicture" type="file" accept="image/*">
						</div>
					</div>-->
				</div>
			</div>

			<!--提交按钮-->
			<div class="submit-add-idinfo-box">
				<div class="weui-btn weui-btn_primary btn" onclick="addEvaluation()">发布评价</div>
			</div>
		</div>
		<script src="../../static/js/wx_ltone/jquery-2.1.4.js" th:src="@{/js/wx_ltone/jquery-2.1.4.js}" ></script>
		<script src="../../static/js/wx_ltone/fastclick.js" th:src="@{/js/wx_ltone/fastclick.js}" ></script>
		<script src="../../static/js/wx_ltone/jquery-weui.js" th:src="@{/js/wx_ltone/jquery-weui.js}" ></script>
		<script src="../../static/js/wx_ltone/common.js" th:src="@{/js/wx_ltone/common.js}" ></script>
		<script src="../../static/js/basePathConfig.js" th:src="@{/js/basePathConfig.js}" ></script>
		<script>
			var order_id = getUrlParam('order_id');
			var store_id = getUrlParam('store_id');
			
			$(function() {
				FastClick.attach(document.body);
				
				// 查询商品信息
				$.ajax({ 
			    	type : "GET", //提交方式 
			    	url : basePath + '/wenxin_store/findStore',
			    	data : { 
			     		store_id: store_id
			    	},// 数据，这里使用的是Json格式进行传输 
			    	success : function(result) {
			     		// 返回数据根据结果进行相应的处理 
			      		// console.log(JSON.stringify(result));
		      			var storeName = result.data.store_name; // 商品名
		      			var storePictureArr = result.data.store_picture.split(';'); // 图片
		      			var price = result.data.store_price; // 价格
		      			
		      			$('#store_picture').attr("src", baseImgPath+storePictureArr[0]);
		      			$('#storeName').html(storeName);
		      			$('#price').html('￥'+ price.toFixed(2));
			    	},
		     		error: function (err){
			     		$.toast('网络错误，请稍后重试...');
			     		return;
		     		}
			    });
			});
			
			function addEvaluation(){
				var evaluationVal = $('#evaluation_value').val();
				if(evaluationVal == null || evaluationVal == '') {
					$.alert('请输入您的看法或意见...');
					return;
				} else if(isEmojiCharacter(evaluationVal)) {
					$.alert('包含非法字符，请重新输入...');
					$('#evaluation_value').empty();
					return false;
				}
				// 添加评论
				$.ajax({ 
			    	type : "POST", //提交方式 
			    	url : basePath + '/wenxin_store/addEvaluation',
			    	data : { 
			     		store_id: store_id,
						order_id: order_id,
						evaluation_value: evaluationVal
			    	},//数据，这里使用的是Json格式进行传输 
			    	success : function(result) {
			     		//返回数据根据结果进行相应的处理 
			      		// console.log(JSON.stringify(result));
		      			$.alert('添加评论成功');
		      			window.location = basePath + '/maid/myOrder';
		    		},
		     		error: function (err){
			     		$.toast('网络错误，请稍后重试...');
			     		return;
		     		}
			    });
	   		}
		</script>
	</body>
</html>
