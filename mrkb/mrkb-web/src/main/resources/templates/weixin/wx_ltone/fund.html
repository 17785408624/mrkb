<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<title>紫罗兰公益</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/weui.min.css" th:href="@{/css/wx_ltone/weui.min.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/jquery-weui.css" th:href="@{/css/wx_ltone/jquery-weui.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/reset.css" th:href="@{/css/wx_ltone/reset.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/mainstyle.css" th:href="@{/css/wx_ltone/mainstyle.css}" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/public.css" th:href="@{/css/wx_ltone/public.css}" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/fund.css" th:href="@{/css/wx_ltone/fund.css}" />
	</head>

	<body>
		<div class="search">
			<div class="search-left">
				<a href="javascript:void(0);" onclick="toBack('/HomeController/home');">
					<img th:src="@{/img/wx_ltone/icon/mine/fanhui.png}">
				</a>
			</div>
		</div>
		<div class="fund-box">
			<img th:src="@{/img/wx_ltone/icon/funLogo.jpg}">
			<div class="fund-money-box">
				<span class="fund-money-tip">天使公益基金可使用金额：</span>
				<div class="fund-money">
					<span id="money"></span>
				</div>
			</div>
			<div class="fund-tip">
				将快乐传递一亿人
			</div>
		 </div>
		<div class="fun-list" id="fundList"></div>
		<script src="../../static/js/wx_ltone/jquery-2.1.4.js" th:src="@{/js/wx_ltone/jquery-2.1.4.js}" ></script>
		<script src="../../static/js/wx_ltone/fastclick.js" th:src="@{/js/wx_ltone/fastclick.js}" ></script>
		<script src="../../static/js/wx_ltone/jquery-weui.js" th:src="@{/js/wx_ltone/jquery-weui.js}" ></script>
		<script src="../../static/js/wx_ltone/common.js" th:src="@{/js/wx_ltone/common.js}" ></script>
		<script src="../../static/js/basePathConfig.js" th:src="@{/js/basePathConfig.js}" ></script>
		<script type="text/javascript">
			
			//返回上级
			function toBack(path){
				if (window.history && window.history.pushState) {
			   		$(window).on('popstate', function () {
			      		window.history.pushState('forward', window.location = basePath + path, '#');
			        });
			    }
			    window.history.pushState('forward', window.location = basePath + path, '#'); 
			}
		
			$(function() {
				FastClick.attach(document.body);
				
				// 获取公益列表
				$.ajax({ 
			    	type : "GET", //提交方式 
			    	url : basePath + '/weixin_news/findNews',
			    	data : { 
			     		news_type: 5
			    	},//数据，这里使用的是Json格式进行传输 
			    	success : function(result) {
		      			fillFundList(result.data);
			    	},
		     		error: function (err){
			     		$.toast('网络错误，请稍后重试...');
			     		return;
		     		}
			    });
			    
			    // 获取基金金额
				$.ajax({ 
			    	type : "GET", //提交方式 
			    	url : basePath + '/weixin_news/findNews',
			    	data : { 
			     		news_type: 3
			    	},//数据，这里使用的是Json格式进行传输 
			    	success : function(result) {
		      			var money=result.data[0].fund_money;
		      			$('#money').html('￥' + money.toFixed(2));
			    	},
		     		error: function (err){
			     		$.toast('网络错误，请稍后重试...');
			     		return;
		     		}
			    });
			});
			
			// 填充公益列表
			function fillFundList(data){
				if(data != ''){
					var htmlStr = '';
					for(var i = 0; i < data.length; i++){
						htmlStr = '<div class="default-text-color list-box" onclick="window.location =\''+ basePath + '/HomeController/fundDetail?news_id='+ data[i].news_id +'&news_type='+ data[i].news_type +'\'">'+
								  '	<h4>'+ data[i].news_title +'</h4>'+
								  '	<img src="'+ data[i].news_picture.split(";")[0] +'" onerror="javascript:this.src=\'http://via.placeholder.com/360X150\'">'+
								  '	<div class="position-relative intro-box">'+
								  '		<label class="intro-data">'+ formatDateTimeStr(data[i].add_date,0) +'</label>'+
								  '		<label class="intro-options">'+
								  '			<span class="intro">'+
								  '				<img class="icon-yueduliang" src="/morekaba/img/wx_ltone/icon/mine/chakan.png"/>&nbsp;&nbsp;'+
								  '				<span>'+ data[i].read_num +'</span>'+
								  '			</span>'+
								  '			<span class="intro">'+
								  '				<img class="icon-zan" src="/morekaba/img/wx_ltone/icon/mine/dianzan.png"/>&nbsp;&nbsp;'+
								  '				<span>'+ data[i].thumbs_up +'</span>'+
								  '			</span>'+
								  '		</label>'+
								  '	</div>'+
								  '</div>';
						$('#fundList').append(htmlStr);
					}
				}else{
					$.alert('暂无数据');
					return;
				}
			}
		</script>
	</body>
</html>
