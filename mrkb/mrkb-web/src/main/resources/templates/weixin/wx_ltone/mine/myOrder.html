<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<title>我的订单</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/weui.min.css" th:href="@{/css/wx_ltone/weui.min.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/jquery-weui.css" th:href="@{/css/wx_ltone/jquery-weui.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/reset.css" th:href="@{/css/wx_ltone/reset.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/mainstyle.css" th:href="@{/css/wx_ltone/mainstyle.css}" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/public.css" th:href="@{/css/wx_ltone/public.css}" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/myOrder.css" th:href="@{/css/wx_ltone/myOrder.css}"/>
		
	</head>
	<body>
		<div class="search">
			<div class="search-left">
				<a href="javascript:history.go(-1);">
					<img th:src="@{/img/wx_ltone/icon/mine/fanhui.png}">
				</a>
			</div>
		</div>
		<div class="mdfd-content">
			<div class="menu-order">
				<div class="menu-order-single menu-order-active" id="allOrderList" onclick="findOrder(0,this)">
					全部
				</div>
				<div class="menu-order-single" onclick="findOrder(2,this)">
					待付款
				</div>
				<!--<div class="menu-order-single" onclick="findOrder(3,this)">
					已付款
				</div>-->
				<div class="menu-order-single" onclick="findOrder(4,this)">
					待上课
				</div>
				<div class="menu-order-single" onclick="findOrder(5,this)">
					已上课
				</div>
			</div>
			<div id="orderlist" class="order-list"></div>
		</div>
		<script src="../../static/js/wx_ltone/jquery-2.1.4.js" th:src="@{/js/wx_ltone/jquery-2.1.4.js}" ></script>
		<script src="../../static/js/wx_ltone/fastclick.js" th:src="@{/js/wx_ltone/fastclick.js}" ></script>
		<script src="../../static/js/wx_ltone/jquery-weui.js" th:src="@{/js/wx_ltone/jquery-weui.js}" ></script>
		<script src="../../static/js/basePathConfig.js" th:src="@{/js/basePathConfig.js}" ></script>
		<script>
			$(function() {
				
				findOrder(0,$('#allOrderList'));
				
			});
			
			function findOrder(order_status,e){
	  			$(".menu-order-single").removeClass("menu-order-active");
	   			$(e).addClass("menu-order-active");
	   			// 查询所有订单
				$.ajax({ 
			    	type : "GET", //提交方式 
			    	url : basePath + '/order_weixin/findOrder',
			    	data : { 
			     		order_status: order_status
			    	},//数据，这里使用的是Json格式进行传输 
			    	success : function(result) {
			     		//返回数据根据结果进行相应的处理 
		      			fillOrderData(result.data);
			    	},
		     		error: function (err){
			     		$.toast('网络错误，请稍后重试...');
			     		return;
		     		}
			    });
	   		}
	   		
	   		// 填充订单数据
	   		function fillOrderData(data){
	   			$('#orderlist').empty();
	   			if(data != null || data != ''){
	   				var htmlStr = '',orderStateTip = '';
	   				for(var i = 0; i < data.length; i++){
	   					// 订单状态(1待收款，2待付款，3待发货，4（已发货）确认收货，5已收货（评价），6取消订单审核中，
	   					// 7退款中，8订单已取消，9.已评价，10，申请退货，11完成订单，12同意退款，13拒绝退款，14同意退货，15拒绝退货)
	   					if(data[i].order_status==2){
		  					//按理应该是2才对，数据库是1待确认  
		  			 		orderStateTip = '	<span onclick="deleteOrder('+data[i].order_id+')" class="order-btn">取消订单</span>'+
								 			'	<span class="order-btn" onclick="window.location=\''+ basePath +'/payController/toPay?orderNo='+ data[i].order_id +'\'">去付款</span>';
				  		}/*else if(data[i].order_status==3||data[i].order_status==1){
				   	 		orderStateTip = '	<span class="order-btn">待上课</span>';
				  		}*/else if(data[i].order_status==4){
				     		/*'	<span class="order-btn">查看物流</span>'+*/
                            orderStateTip =  '	<span class="order-btn">待上课</span>';// onclick="confirmReceipt('+ data[i].order_id +')"
				  		}else if(data[i].order_status==5){
				   	  		orderStateTip = '	<span class="order-btn" onclick="window.location=\''+ basePath +'/maid/toInvoicing?order_id='+data[i].order_id +'&all_price='+data[i].all_price+ '\'">申请发票</span>'+
				   	 						'	<span class="order-btn" onclick="window.location=\''+ basePath +'/maid/refreshment?order_id='+ data[i].order_id +'\'">复训</span>'+
				   	  						'	<span class="order-btn" onclick="window.location=\''+ basePath +'/wenxin_store/toAddEvaluate?store_id='+data[i].store_id+'&order_id='+data[i].order_id+'\'">评价</span>';
				  		}else if(data[i].order_status==6){
				   	  		orderStateTip = '	<span class="order-btn">申请退款中</span>'+
						 					'	<span class="order-btn">等待退款</span>';
				  		}else if(data[i].order_status==7){
				   	  		orderStateTip = '	<span class="order-btn">退款处理中</span>';
				  		}else if(data[i].order_status==8){
				   	  		orderStateTip = '	<span class="order-btn">退款成功</span>';
				  		}else if(data[i].order_status==9){//
				   	 		orderStateTip = '	<span class="order-btn">已评价</span>'+
				   	 						'	<span class="order-btn" onclick="window.location=\''+ basePath +'/maid/toInvoicing?order_id='+data[i].order_id +'&all_price='+data[i].all_price+ '\'">申请发票</span>'+
				   	 						'	<span class="order-btn" onclick="window.location=\''+ basePath +'/maid/refreshment?order_id='+ data[i].order_id +'\'">复训</span>';
				  		}else if(data[i].order_status==10){
				   	  		orderStateTip = '	<span class="order-btn">退货申请中</span>';
				  		}else if(data[i].order_status==11){
				   	  		orderStateTip = '	<span class="order-btn">订单已完成</span>';
				  		}else if(data[i].order_status==12){
				   	  		orderStateTip = '	<span class="order-btn">退货处理中</span>';
				  		}
	   					
	   					
	   					htmlStr += '<div class="order-single">'+
	   							   '	<div class="order-detail" onclick="window.location=\''+ basePath +'/order_weixin/myOrderDetail?order_id='+ data[i].order_id +'\'">'+
	   							   '		<div class="order-info">'+
	   							   '			<div class="order-img">'+
	   							   '				<img src="'+ baseImgPath + data[i].store_picture.split(';')[0] +'" onerror="javascript:this.src=\'http://via.placeholder.com/100X100\'">'+
	   							   '			</div>'+
	   							   '			<div class="default-text-color store-title">'+ data[i].store_name +'</div>'+
	   							   '			<div style="display: block;font-size: 15px;text-align: right;color: #333;"><label>X'+ data[i].store_amount +'</label></div>'+
	   							   '			<div style="display: block;font-size: 15px;text-align: right;color: #333;"><label>应付余额:'+ data[i].all_price +'</label></div>'+
	   							   '		</div>'+
	   							   '	</div>'+
	   							   '	<div class="order-btn-list">'+ orderStateTip +'</div>'+
	   							   '</div>';
	   				}
	   				$('#orderlist').html(htmlStr);
	   			}else{
	   				$.toast('请求数据为空...');
	   				return;
	   			}
	   		}
	   		
	   		//取消订单deleteOrder
	 		function deleteOrder(order_id) {
	 			$.confirm("确定取消订单么?", "提示", function() {
					// 取消订单
					$.ajax({ 
				    	type : "POST", //提交方式 
				    	url : basePath + '/order_weixin/deleteOrder',
				    	data : { 
				     		order_id: order_id
				    	},
				    	success : function(result) {
				     		//返回数据根据结果进行相应的处理 
				      		console.log(JSON.stringify(result));
			      			$.alert('取消订单成功！');
			      			location.reload();
				    	},
			     		error: function (err){
				     		$.toast('网络错误，请稍后重试...');
				     		return;
			     		}
				    });
				}, function() {
				  //取消操作
				});
       		}
       		
       		// 确定收货
       		function confirmReceipt(order_id){
 	    		// 确认收货
				$.ajax({ 
			    	type : "POST", //提交方式 
			    	url : basePath + '/order_weixin/updateOrder',
			    	data : { 
			     		order_id: order_id,
			     		order_status: 5
			    	},
			    	success : function(result) {
			     		//返回数据根据结果进行相应的处理 
			      		console.log(JSON.stringify(result));
		      			location.reload();
			    	},
		     		error: function (err){
			     		$.toast('网络错误，请稍后重试...');
			     		return;
		     		}
			    });
			}
		</script>
		
	</body>
</html>
