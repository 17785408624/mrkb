<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mrkb.dao.dao.CoFounderMonSaleMapper" >
<insert id="insertCoFounderMonSale" parameterType="com.mrkb.dao.modle.company.CoFounderMonSale" useGeneratedKeys="true" keyProperty="co_founder_mon_sale_id">  
    INSERT INTO co_founder_mon_sale (
    user_basics_id
    ,month_date
    ,mon_sale_timely
    ,mon_sale_untimely
    ,team_bonus
    ,avg_bonus
    ,achievement_bonus
    ,founder_bonus
    ,start_time
    ,end_time
    ,if_settlement
    )  
    VALUES(
     #{user_basics_id,jdbcType=INTEGER}
    ,#{month_date,jdbcType=VARCHAR}
    ,#{mon_sale_timely,jdbcType=DOUBLE}
    ,#{mon_sale_untimely,jdbcType=DOUBLE}
    ,#{team_bonus,jdbcType=DOUBLE}
    ,#{avg_bonus,jdbcType=DOUBLE}
    ,#{achievement_bonus,jdbcType=DOUBLE}
    ,#{founder_bonus,jdbcType=DOUBLE}
    ,#{start_time,jdbcType=BIGINT}
    ,#{end_time,jdbcType=BIGINT}
    ,#{if_settlement,jdbcType=INTEGER}
    )  
</insert> 
<update id="updateCoFounderMonSale" parameterType="com.mrkb.dao.modle.company.CoFounderMonSale">
         update co_founder_mon_sale  
         set user_basics_id=#{user_basics_id,jdbcType=INTEGER} 
         <if test="mon_sale_timely!=null">
         ,mon_sale_timely=mon_sale_timely+#{mon_sale_timely,jdbcType=DOUBLE} 
         </if>
         <if test="avg_bonus!=null">
         ,avg_bonus=avg_bonus+#{avg_bonus,jdbcType=DOUBLE} 
         </if>
          <if test="achievement_bonus!=null">
         ,achievement_bonus=achievement_bonus+#{achievement_bonus,jdbcType=DOUBLE} 
         </if>
         <if test="mon_sale_untimely!=null">
         ,mon_sale_untimely=mon_sale_untimely+#{mon_sale_untimely,jdbcType=DOUBLE} 
         </if>
         <if test="team_bonus!=null">
         ,team_bonus=team_bonus+#{team_bonus,jdbcType=DOUBLE} 
         </if>
         <if test="founder_bonus!=null">
         ,founder_bonus=founder_bonus+#{founder_bonus,jdbcType=DOUBLE} 
         </if>
         <if test="if_settlement!=null">
         ,if_settlement=#{if_settlement,jdbcType=INTEGER} 
         </if>
         where 1=1 
         and user_basics_id=#{user_basics_id,jdbcType=INTEGER} 
         and month_date=#{month_date,jdbcType=VARCHAR};
 </update>
<select id="findCoFounderOne" resultType="com.mrkb.dao.modle.company.CoFounderMonSale" parameterType="com.mrkb.dao.modle.company.CoFounderMonSale">
         select * from co_founder_mon_sale 
         where 1=1 
         and user_basics_id=#{user_basics_id,jdbcType=INTEGER} 
         and month_date=#{month_date,jdbcType=VARCHAR};
 </select>
 <select id="findCompanyCo" resultType="com.mrkb.dao.modle.company.CoFounderMonSale" parameterType="java.util.HashMap">
         select a.*,b.information_compellation 
         from co_founder_mon_sale a 
         left JOIN user_information b on b.user_basics_id=a.user_basics_id
		where 1=1
		<if test="month_date != null">
			and a.month_date=#{month_date,jdbcType=VARCHAR} 
		</if>
		order by a.month_date desc
 </select>
  <select id="find2SubordinateCo" resultType="com.mrkb.dao.modle.company.CoFounderMonSale">
         select a.information_compellation,a.user_basics_id,c.weixin_portrait,d.co_founder_mon_sale_id,d.month_date,d.mon_sale_timely,count(e.co_user_basics_id) as team_num
         from user_information a 
		LEFT JOIN user_recommend b
		on a.user_basics_id=b.user_basics_id
		LEFT JOIN user_weixin c
		on a.user_basics_id=c.user_basics_id
		LEFT JOIN co_founder_mon_sale d
		on a.user_basics_id=d.user_basics_id and d.month_date=#{month_date,jdbcType=VARCHAR}
		left join user_information e 
 		on e.co_user_basics_id= a.user_basics_id
		where 1=1
		and a.co_founder=3
		and b.recommend_superior in (
	<foreach collection="user_basics_ids" separator="," item="user_basics_id" index="idx">
        #{user_basics_id,jdbcType=INTEGER}
    </foreach>
	)
	group by a.user_basics_id
 </select>
  <select id="find2SubordinateCoOne" resultType="com.mrkb.dao.modle.company.CoFounderMonSale">
     select a.information_compellation,a.user_basics_id,c.weixin_portrait,d.co_founder_mon_sale_id,d.month_date,d.mon_sale_timely,count(e.co_user_basics_id) as team_num
     from user_information a 
	LEFT JOIN user_weixin c
	on a.user_basics_id=c.user_basics_id
	LEFT JOIN co_founder_mon_sale d
	on a.user_basics_id=d.user_basics_id and d.month_date=#{month_date,jdbcType=VARCHAR}
	left join user_information e 
 	on e.co_user_basics_id= a.user_basics_id
	where 1=1
	and a.co_founder=3
	and a.user_basics_id =#{user_basics_id,jdbcType=INTEGER}
	and e.co_user_basics_id=#{user_basics_id,jdbcType=INTEGER}
 </select>
<select id="findCompanyCountCountCo" resultType="com.mrkb.dao.modle.user.UserInformationEntity" parameterType="java.util.HashMap">
        select b.* from  user_information b 
		LEFT JOIN user_basics c on c.user_basics_id=b.user_basics_id 
		where 1=1
		and c.user_grade_id&gt;=2 
		and b.company_id=#{company_id,jdbcType=INTEGER}
		and b.co_founder=3; 
 </select>
</mapper>
