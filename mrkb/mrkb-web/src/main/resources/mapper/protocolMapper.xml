<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mrkb.dao.dao.ProtocolMapper">
 <!-- 新增协议 -->
 <insert id="addProtocol" parameterType="com.mrkb.dao.modle.protocol.ProtocolEntity" useGeneratedKeys="true" keyProperty="protocol_id" >
  insert into protocol
		(protocol_type,protocol_title,protocol_content,status_state,add_date) 
		value(
		 #{protocol_type,jdbcType=INTEGER}
		,#{protocol_title,jdbcType=VARCHAR}
		,#{protocol_content,jdbcType=VARCHAR}
		,#{status_state,jdbcType=INTEGER}
		,#{add_date,jdbcType=BIGINT}
		);
 </insert>
 <!-- 查询所有协议-->
 <select id="findAllProtocol" resultType="com.mrkb.dao.modle.protocol.ProtocolEntity" parameterType="com.mrkb.dao.modle.protocol.ProtocolEntity">
         select * from protocol where 1=1
         <if test="status_state!=null">
	      and status_state =#{status_state,jdbcType=INTEGER}          
         </if>
         <if test="protocol_title != null and protocol_title != ''">
			and `protocol_title` like concat('%',#{protocol_title},'%')
		</if>
 </select>
 <!-- 查询单个协议-->
 <select id="findProtocolById" resultType="com.mrkb.dao.modle.protocol.ProtocolEntity" parameterType="com.mrkb.dao.modle.protocol.ProtocolEntity">
         select * from protocol where 1=1
          and protocol_id =#{protocol_id,jdbcType=INTEGER}
 </select>
 <!-- 修改单个协议-->
 <update id="updateProtocol" parameterType="com.mrkb.dao.modle.protocol.ProtocolEntity">
	  update protocol set
	    <trim  suffixOverrides="," >
	  	 <if test="protocol_title!=null">
	      protocol_title=#{protocol_title,jdbcType=VARCHAR},
	     </if>
	     <if test="protocol_content!=null">
	      protocol_content=#{protocol_content,jdbcType=VARCHAR},
	     </if>
	     <if test="status_state!=null">
	      status_state=#{status_state,jdbcType=INTEGER},
	     </if>
	    </trim>
	  where protocol_id=#{protocol_id,jdbcType=INTEGER} 
	</update>  
 
 <!-- 删除协议(物理删除)-->
 <delete id="deleteProtocols" parameterType="com.mrkb.dao.modle.protocol.ProtocolEntity" >
		delete from protocol where protocol_id=#{protocol_id,jdbcType=INTEGER} ;
	</delete>
	<!-- 协议审核 -->
	<update id="updateProtocolState" parameterType="com.mrkb.dao.modle.protocol.ProtocolEntity">
		update protocol set 
			<if test="status_state!=null">
			status_state=#{status_state,jdbcType=INTEGER}
			</if>
		where 1=1
		and protocol_id = #{protocol_id,jdbcType=INTEGER}
	</update>
     <!-- 删除协议(逻辑删除)  -->
	<update id="deleteProtocol" parameterType="com.mrkb.dao.modle.protocol.ProtocolEntity">
		update protocol set
		status_state=3 where protocol_id=#{protocol_id,jdbcType=INTEGER};
	</update>
</mapper>