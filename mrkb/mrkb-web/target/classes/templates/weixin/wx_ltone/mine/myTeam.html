<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<title>我的社区</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/weui.min.css" th:href="@{/css/wx_ltone/weui.min.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/jquery-weui.css" th:href="@{/css/wx_ltone/jquery-weui.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/mine.css" th:href="@{/css/wx_ltone/mine.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/reset.css" th:href="@{/css/wx_ltone/reset.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/mainstyle.css" th:href="@{/css/wx_ltone/mainstyle.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/public.css"  th:href="@{/css/wx_ltone/public.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/myTeam.css" th:href="@{/css/wx_ltone/myTeam.css}"/>
	</head>
	<body>
		<div class="search">
			<div class="search-left">
				<a href="javascript:history.go(-1);">
					<img th:src="@{/img/wx_ltone/icon/mine/fanhui.png}">
				</a>
			</div>
		</div>
		<div class="mdfd-content">
			<div class="bonus-show default-text-color">
				<span style="color:#8F25FF;font-size: 60px;" id="amount"></span><br>
				<span style="color:#8F25FF;font-size: 18px;">社区总人数</span>
			</div>
			<ul class="mdfd-content_huiyuan">
				<li style="border-right: 1px solid #ccc;width: 49%;" onclick="clickShowDiv(this,'yghy_div');">
					<span>星级紫罗兰</span>
					<img class="content_huiyuan_img" th:src="@{/img/wx_ltone/icon/mine/arrowdown.png}" style="display: none;" />
					<img class="content_huiyuan_img" th:src="@{/img/wx_ltone/icon/mine/arrowup.png}"/>
				</li>
				<li onclick="clickShowDiv(this,'wghy_div');">
					<span>普通紫罗兰</span>
					<img class="content_huiyuan_img" th:src="@{/img/wx_ltone/icon/mine/arrowdown.png}" style="display: none;" />
					<img class="content_huiyuan_img" th:src="@{/img/wx_ltone/icon/mine/arrowup.png}"/>
				</li>
			</ul>

			<div class="mdfd-content_huiyuans" id="yghy_div">
				<p id="yghy_num" style="color: #8F25FF;">第一代星级紫罗兰总人数：<span style="color:#ffa954;"></span></p>
				<ul id="yghy_detail" style="list-style: none;margin:10px 0px;padding:0;">
					
				</ul>
				<div class="mdfd-content_zonghuiyuan">
					<p>星级紫罗兰总人数：<span id="buyAmount"></span>人</p>
					<ul id="buyMemberSubordinate">
						<li>
							<span><label id="buyAmount1" style="color:#666;"></label>&nbsp;人</span><br>
							<span>第一代会员</span>
						</li>
						<!--<li>
							<span><label id="buyAmount2" style="color:#666;"></label>&nbsp;人</span><br>
							<span>第二代会员</span>
						</li>
						<li>
							<span><label id="buyAmount3" style="color:#666;"></label>&nbsp;人</span><br>
							<span>第三代会员</span>-->
						</li>
					</ul>
				</div>
			</div>
			<div class="mdfd-content_huiyuans" id="wghy_div" style="display: none;">
				<p id="wghy_num" style="color: #8F25FF;">第一代普通紫罗兰总人数：<span style="color:#ffa954;"></span></p>
				<ul id="wghy_detail" style="list-style: none;margin:10px 0px;padding:0;">
					
				</ul>
				<div class="mdfd-content_zonghuiyuan">
					<p>普通紫罗兰总人数：<span id="buyAmountNo"></span>人</p>
					<ul id="buyMemberSubordinateNo">
						<li>
							<span><label id="buyAmountNo1" style="color:#666;"></label>&nbsp;人</span><br>
							<span>第一代会员</span>
						</li>
						<!--<li>
							<span><label id="buyAmountNo2" style="color:#666;"></label>&nbsp;人</span><br>
							<span>第二代会员</span>
						</li>
						<li>
							<span><label id="buyAmountNo3" style="color:#666;"></label>&nbsp;人</span><br>
							<span>第三代会员</span>
						</li>-->
					</ul>
				</div>
			</div>
		</div>
		<script src="../../static/js/wx_ltone/jquery-2.1.4.js" th:src="@{/js/wx_ltone/jquery-2.1.4.js}" ></script>
		<script src="../../static/js/wx_ltone/fastclick.js" th:src="@{/js/wx_ltone/fastclick.js}" ></script>
		<script src="../../static/js/wx_ltone/jquery-weui.js" th:src="@{/js/wx_ltone/jquery-weui.js}" ></script>
		<script src="../../static/js/basePathConfig.js" th:src="@{/js/basePathConfig.js}" ></script>
		<script>
			$(function() {
				FastClick.attach(document.body);
				
				// 获取知识列表
				$.ajax({ 
			    	type : "GET", //提交方式 
			    	url : basePath + '/user_weixin/findUserSubordinateInculdeOrderBasics',
			    	data : { 
			    	},//数据，这里使用的是Json格式进行传输 
			    	success : function(result) {
			    		// alert(JSON.stringify(result));
			      		if(result.data){
			      			showMyteamNum(result.data);
			      		}
			    	},
		     		error: function (err){
			     		$.toast('网络错误，请稍后重试...');
			     		return;
		     		}
			    });
			});
			
			function showMyteamNum(data) {
				var amount; //总人数
				var buyAmount; //已购买人数
				var object = data; //后台数据库返回数据
				var subordinate1 = object[1]; //一级下属
				var subordinateBuy1, subordinateBuyNo1; //一级未购和已购下属
				/*var subordinate2 = object[2]; //二级下属
				var subordinateBuy2, subordinateBuyNo2; //二级未购和已购下属
				var subordinate3 = object[3]; //三级下属
				var subordinateBuy3, subordinateBuyNo3; //三级未购和已购下属*/
				subordinateBuy1 = getBuySubordinate(subordinate1); //得到一级以购买下属
				/*subordinateBuy2 = getBuySubordinate(subordinate2); //得到二级以购买下属
				subordinateBuy3 = getBuySubordinate(subordinate3); //得到三级以购买下属*/

				subordinateBuyNo1 = getBuySubordinateNo(subordinate1); //得到一级未购买下属
				/*subordinateBuyNo2 = getBuySubordinateNo(subordinate2); //得到二级未购买下属
				subordinateBuyNo3 = getBuySubordinateNo(subordinate3); //得到三级未购买下属*/

				amount = subordinate1.length; //得到总人数/* + subordinate2.length + subordinate3.length*/
				buyAmount = subordinateBuy1.length; //已购买人数/* + subordinateBuy2.length + subordinateBuy3.length*/

				// 总人数、已购总人数、未购总人数数据填充
				$('#amount').html(amount);
				$('#buyAmount').html(buyAmount);
				$('#buyAmount1').html(subordinateBuy1.length);
				/*$('#buyAmount2').html(subordinateBuy2.length);
				$('#buyAmount3').html(subordinateBuy3.length);*/
				$('#buyAmountNo').html(parseInt(amount) - parseInt(buyAmount));
				$('#buyAmountNo1').html(parseInt(subordinate1.length) - parseInt(subordinateBuy1.length));
				/*$('#buyAmountNo2').html(parseInt(subordinate2.length) - parseInt(subordinateBuy2.length));
				$('#buyAmountNo3').html(parseInt(subordinate3.length) - parseInt(subordinateBuy3.length));*/
				
				// 数据填充
				setFillData($('#yghy_num'), $('#yghy_detail'), subordinateBuy1, '第一代已购');

				// 已购会员级数选择
				$("#buyMemberSubordinate li").each(function(i, btn) {
					var subordinate = eval('subordinateBuy' + (i + 1));
					var subordinateNum = '';
					switch (i) {
						case 0:
							subordinateNum = '星级紫罗兰';
							break;
						/*case 1:
							subordinateNum = '第二代已购';
							break;
						case 2:
							subordinateNum = '第三代已购';
							break;*/
					}
					btn.addEventListener('click', function() {
						setFillData($('#yghy_num'), $('#yghy_detail'), subordinate, subordinateNum);
						$(this).parent().parent().hide();
						$('.mdfd-content_huiyuan').find('li').first().find('i:eq(0)').hide();
						$('.mdfd-content_huiyuan').find('li').first().find('i:eq(1)').show();
						$('.mdfd-content_huiyuan').find('li').last().find('i:eq(1)').show();
						$('.mdfd-content_huiyuan').find('li').last().find('i:eq(0)').hide();
					}, false);
				});

				// 未购会员级数选择
				$("#buyMemberSubordinateNo li").each(function(i, btn) {
					var subordinate = eval('subordinateBuyNo' + (i + 1));
					var subordinateNum = '';
					switch (i) {
						case 0:
							subordinateNum = '普通紫罗兰';
							break;
						/*case 1:
							subordinateNum = '第二代未购';
							break;
						case 2:
							subordinateNum = '第三代未购';
							break;*/
					}

					btn.addEventListener('click', function() {
						setFillData($('#wghy_num'), $('#wghy_detail'), subordinate, subordinateNum);
						$(this).parent().parent().hide();
						$('.mdfd-content_huiyuan').find('li').first().find('i:eq(0)').hide();
						$('.mdfd-content_huiyuan').find('li').first().find('i:eq(1)').show();
						$('.mdfd-content_huiyuan').find('li').last().find('i:eq(1)').show();
						$('.mdfd-content_huiyuan').find('li').last().find('i:eq(0)').hide();
					}, false);
				});

			}
			
			/**
			 * @description 会员数据填充
			 * @param {Object} obj 几代会员对象
			 * @param {Object} objDetail 会员信息
			 */
			function setFillData(obj, objDetail, peopleNumArr, subordinateNum) {
				obj.html(subordinateNum + '会员总人数：<span style="color:#ffa954;">' + peopleNumArr.length + '</span>人');
				var html = '';
				for (var i = 0; i < peopleNumArr.length; i++) {
					html += '<li class="mdfd-content_huiyuans_li" user-basics-id="' + peopleNumArr[i].user_basics_id + 
							'" superior-weixin-nickname="' + peopleNumArr[i].superior_weixin_nickname + 
							'" weixin-portrait="' + peopleNumArr[i].weixin_portrait + 
							'" weixin-nickname="'+ peopleNumArr[i].weixin_nickname +'">' +
							'	<div class="mdfd-content_huiyuans_li_img">' +
							'		<img src="' + peopleNumArr[i].weixin_portrait + '" onerror="javascript:this.src=\'http://via.placeholder.com/60x60\'">' +
							'	</div>' +
							'	<span>用户：' + peopleNumArr[i].weixin_nickname + '</span>' +
							'</li>';
				}
				objDetail.html(html);
			}
			
			// 已购
			function getBuySubordinate(subordinate) {
				var length = 0;
				var buySubordinate = new Array();
				subordinate.forEach(function(value, index, array) {
					if (value.user_grade_id >= 2) {
						buySubordinate[length] = value;
						length++;
					}
				});
				return buySubordinate;
			}

			// 未购
			function getBuySubordinateNo(subordinate) {
				var length = 0;
				var buySubordinateNo = new Array();
				subordinate.forEach(function(value, index, array) {
					if (value.user_grade_id < 2 || value.user_grade_id == null) {
						buySubordinateNo[length] = value;
						length++;
					}

				});
				return buySubordinateNo;
			}

			function clickShowDiv(e, id) {
				$(".mdfd-content_huiyuans").each(function() {
					if ($(this).attr("id") == id) {
						if ($(this).children(".mdfd-content_zonghuiyuan").css("display") == 'none') {
							$(this).show();
							$(this).children(".mdfd-content_zonghuiyuan").show();
							$(e).find("img:eq(1)").hide();
							$(e).find("img:eq(0)").show();
						} else {
							$(this).children(".mdfd-content_zonghuiyuan").hide();
							$(e).find("img:eq(0)").hide();
							$(e).find("img:eq(1)").show();
						};
					} else {
						$(this).hide();
						$(this).children(".mdfd-content_zonghuiyuan").hide();
						$(e).siblings().find("img:eq(1)").show();
						$(e).siblings().find("img:eq(0)").hide();
					}
				});
			}
			
			
		</script>
	</body>
</html>
