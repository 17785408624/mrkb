<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<title>我的银行卡</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/weui.min.css" th:href="@{/css/wx_ltone/weui.min.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/jquery-weui.css" th:href="@{/css/wx_ltone/jquery-weui.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/reset.css" th:href="@{/css/wx_ltone/reset.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/mainstyle.css" th:href="@{/css/wx_ltone/mainstyle.css}" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/public.css" th:href="@{/css/wx_ltone/public.css}" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/mine.css" th:href="@{/css/wx_ltone/mine.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/personBankCard.css" th:href="@{/css/wx_ltone/personBankCard.css}"/>

	</head>

	<body>
		<div class="search">
			<div class="search-left">
				<a  href="javascript:history.go(-1);">
					<img th:src="@{/img/wx_ltone/icon/mine/fanhui.png}">
				</a>
			</div>
		</div>
		<div class="mdfd-content">
			<ul id="textValue"></ul>
			<div class="submit-add-idinfo-box">
				<div onclick="identifyPersonal();" class="weui-btn weui-btn_primary btn">添加银行卡</div>
			</div>
		</div>
		<script src="../../static/js/wx_ltone/jquery-2.1.4.js" th:src="@{/js/wx_ltone/jquery-2.1.4.js}" ></script>
		<script src="../../static/js/wx_ltone/fastclick.js" th:src="@{/js/wx_ltone/fastclick.js}" ></script>
		<script src="../../static/js/wx_ltone/jquery-weui.js" th:src="@{/js/wx_ltone/jquery-weui.js}" ></script>
		<script src="../../static/js/basePathConfig.js" th:src="@{/js/basePathConfig.js}" ></script>
		<script>
			$(function() {
				FastClick.attach(document.body);
				
				// 获取银行卡列表
				$.ajax({
					type : "GET", //提交方式 
					url : basePath + '/weixin_bank/findAllBank',
					data : {
						currentPage: 1
					}, //数据，这里使用的是Json格式进行传输 
					success : function(result) {
						//返回数据根据结果进行相应的处理 
						if (result.data) {
							findAllBankInfo(result.data);
						} 
					},
					error : function(err) {
						$.toast('网络错误，请稍后重试...');
						return;
					}
				});
			});
			
			/*查询所有的银行卡信息*/
			function findAllBankInfo(data) {
				var htmlstr = "";
				if (data != null) {
					for (var i = 0; i < data.length; i++) {
						htmlstr +=  '<li class="bankCard_li">' +
									'	<div class="bankCard_libjtimg"></div>'+
									'	<div class="bankCard_li_img">'+ data[i].affiliated_bank +'</div>'+
									'	<div class="bankCard_li_img1"><img src="/morekaba/img/wx_ltone/icon/mine/xp.png"></div>'+
									'	<div class="bankCard_li_span"><label>' + formatBankNumber(data[i].bank_card) + '</label></div>' +
									'	<div class="bankCard_li_imgleft"><img src="/morekaba/img/wx_ltone/icon/mine/dbx.png"><label>ATM</label></div>' +
									'	<div class="bankCard_li_imgright"><img src="/morekaba/img/wx_ltone/icon/mine/yl.png"></div>' +
									'</li>';
					}
					// 追加元素
					document.getElementById('textValue').insertAdjacentHTML('afterbegin', htmlstr);
				} else {
					$.alert("暂无银行卡信息");
				};
			};

			function formatBankNumber(bankNumber) {
				return bankNumber.substr(0, 4) + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;****&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;****&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + bankNumber.substr(-4);
			}
			
			/*添加银行卡验证*/
			function identifyPersonal() {
				// 验证实名认证
				$.ajax({
					type : "GET", //提交方式 
					url : basePath + '/user_weixin/findUserInformOne',
					data : {
						currentPage: 1
					}, //数据，这里使用的是Json格式进行传输 
					success : function(result) {
						//返回数据根据结果进行相应的处理 
						// alert(JSON.stringify(result.data));
						if (result.data) {
							findBankDetailInfo(result.data)
						} 
					},
					error : function(err) {
						$.toast('网络错误，请稍后重试...');
						return;
					}
				});
				
			}
			/*获取用户信息实名,用户id*/
			function findBankDetailInfo(data) {
				if (data.information_compellation == "" || data.information_compellation == null) {
					$.confirm("是否立即实名认证？", "提示", function() {
						window.location = basePath + '/maid/personAddIdentityCard';
					}, function() {
					  //取消操作
					  $.toast('取消');
					  return;
					});
				} else if (data.information_compellation != "") {
					window.location = basePath + '/maid/personAddBankCard';
				}
			}
		</script>
	</body>
</html>
