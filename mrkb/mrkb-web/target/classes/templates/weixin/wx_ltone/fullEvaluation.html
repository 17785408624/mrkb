<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<title>评价详情</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/weui.min.css" th:href="@{/css/wx_ltone/weui.min.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/jquery-weui.css" th:href="@{/css/wx_ltone/jquery-weui.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/reset.css" th:href="@{/css/wx_ltone/reset.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/mainstyle.css" th:href="@{/css/wx_ltone/mainstyle.css}" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/public.css" th:href="@{/css/wx_ltone/public.css}" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/commentEvalution.css" th:href="@{/css/wx_ltone/commentEvalution.css}" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/intelligentAngel.css" th:href="@{/css/wx_ltone/intelligentAngel.css}" />
	</head>
	

	<body>
		<div class="search border-blue">
			<div class="search-left">
				<a href="javascript:history.go(-1);"><!-- onclick="toBack('/HomeController/knowledge');" -->
					<img th:src="@{/img/wx_ltone/icon/mine/fanhui.png}">
				</a>
			</div>
		</div>
		<div class="mencent">
			<div class="detail">
				<ul class="mui-table-view" style="border-bottom:none;margin-bottom:20px;">
				   <li class="mui-table-view-cell mui-media" style="width: 60%;">
			            <img class="mui-media-object mui-pull-left" src="http://placehold.it/40x30" id="headImgUrl">
			            <div class="mui-media-body">
			               	<span id="nickname" class="nickname">末岛晴空·昵称</span>
			                <div class="mui-ellipsis mui-ellipsis-time">
			                	2019-06-11
			                </div>
			            </div>
				    </li>
				    <li class="mui-table-view-cell mui-media" style="width: auto;">
			            <div class="mui-ellipsis-erweima">识别二维码有惊喜</div>
						<img class="mui-ellipsis-img" th:src="@{/img/wx_ltone/icon/mine/erweima.png}">
				    </li>
				</ul>
				<div  id="contentDetail"></div>
			</div>
		</div>
		<script src="../../static/js/wx_ltone/jquery-2.1.4.js" th:src="@{/js/wx_ltone/jquery-2.1.4.js}" ></script>
		<script src="../../static/js/wx_ltone/fastclick.js" th:src="@{/js/wx_ltone/fastclick.js}" ></script>
		<script src="../../static/js/wx_ltone/jquery-weui.js" th:src="@{/js/wx_ltone/jquery-weui.js}" ></script>
		<script src="../../static/js/wx_ltone/common.js" th:src="@{/js/wx_ltone/common.js}" ></script>
		<script src="../../static/js/wx_ltone/setCookie.js" th:src="@{/js/wx_ltone/setCookie.js}" ></script>
		<script src="../../static/js/basePathConfig.js" th:src="@{/js/basePathConfig.js}" ></script>
		<script>
			
			//返回上级
			/* function toBack(path){
				if (window.history && window.history.pushState) {
			   		$(window).on('popstate', function () {
			      		window.history.pushState('forward', window.location = basePath + path, '#');
			        });
			    }
			    window.history.pushState('forward', window.location = basePath + path, '#'); 
			} */
		
			// 获取地址栏参数
			var news_id = getUrlParam('news_id');
			var news_type = getUrlParam('news_type');
			
			$(function() {
				FastClick.attach(document.body);
				
				// 获取知识详情
				$.ajax({ 
			    	type : "GET", //提交方式 
			    	url : basePath + '/weixin_news/findNewsOne',
			    	data : { 
			     		news_type: news_type,
						news_id: news_id
			    	},//数据，这里使用的是Json格式进行传输 
			    	success : function(result) {
		      			filteKnowLedgeDetail(result.data);
			    	},
		     		error: function (err){
			     		$.toast('网络错误，请稍后重试...');
			     		return;
		     		}
			    });
			    
			    // 获取评论
				$.ajax({ 
			    	type : "GET", //提交方式 
			    	url : basePath + '/weixin_news/findEssenceEvaluation',
			    	data : { 
			     		news_type: news_type,
						news_id: news_id
			    	},//数据，这里使用的是Json格式进行传输 
			    	success : function(result) {
			     		//返回数据根据结果进行相应的处理 
			     		// alert(JSON.stringify(result));
		      			fillCommentData(result.data);
			    	},
		     		error: function (err){
			     		$.toast('网络错误，请稍后重试...');
			     		return;
		     		}
			    });
			    
			    // 增加浏览量
				$.ajax({ 
			    	type : "GET", //提交方式 
			    	url : basePath + '/weixin_news/browseNum',
			    	data : {
			    		news_type: news_type,
			    		news_id: news_id 
			    	},//数据，这里使用的是Json格式进行传输 
			    	success : function(result) {},
		     		error: function (err){
			     		$.toast('网络错误，请稍后重试...');
			     		return;
		     		}
			    });
			    
			});
			function filteKnowLedgeDetail(data) {
				var Ahtml = '<div class="title">' +
							'	<h4>' + data.news_title + '</h4>' +
					        '	<img src="' + data.news_picture.split(';')[0] + '" onerror="javascript:this.src=\'http://via.placeholder.com/360x150 \'"/>' +
					        '	<div style="position: relative;padding: 5px 10px;">' +
					        '		<div class="interact">' +
					        '			<div class="yueduliang">' +
					        '				<img class="icon-yueduliang" src="/morekaba/img/wx_ltone/icon/mine/chakan.png" />&nbsp;&nbsp;'+
					        '				<span>' + data.read_num + '</span>' +
					        '			</div>' +
					        '			<div class="dianzan" onclick="addStar('+ data.news_id +','+ data.thumbs_up +')">' +
					        '				<img class="icon-zan" src="/morekaba/img/wx_ltone/icon/mine/dianzan.png"/>&nbsp;&nbsp;'+
					        '				<span id="zan">' + data.thumbs_up + '</span>' +
					        '			</div>' +
					        '		</div>' +
					        '	</div>' +
					        '</div>' +
					        '<div class="detail-content">' + data.detail_content + '</div>';
				$("#contentDetail").append(Ahtml);
			}
			
			/*
			* 实现点赞功能
			* @param    资源id
			* */
			function addStar(news_id,thumbs_up){
			    var videoNewsId = getCookieById('knowledgeNewsId',news_id);
			    if(videoNewsId == ''){
			        addCookieById('knowledgeNewsId',news_id,365);
					$.ajax({ 
				    	type : "GET", //提交方式 
				    	url : basePath + '/weixin_news/thumbsUp',
				    	data : {
				    		news_type: news_type,
				    		news_id: news_id 
				    	},//数据，这里使用的是Json格式进行传输 
				    	success : function(result) {
			      			thumbs_up=parseInt($('#zan').html())+1;
							$("#zan").html(thumbs_up);
				    	},
			     		error: function (err){
				     		$.toast('网络错误，请稍后重试...');
				     		return;
			     		}
				    });
			    }else{
			        $.alert('您已经点赞过啦！');
			        return;
			    }
			}
		
		</script>
	</body>
</html>
