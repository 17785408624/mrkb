<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<title>确认订单</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/weui.min.css" th:href="@{/css/wx_ltone/weui.min.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/jquery-weui.css" th:href="@{/css/wx_ltone/jquery-weui.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/reset.css" th:href="@{/css/wx_ltone/reset.css}"/>
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/mainstyle.css" th:href="@{/css/wx_ltone/mainstyle.css}" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/public.css" th:href="@{/css/wx_ltone/public.css}" />
		<link rel="stylesheet" type="text/css" href="../../css/wx_ltone/pay.css" th:href="@{/css/wx_ltone/pay.css}"/>
	</head>
	<body>
		<div class="search">
			<div class="search-left">
				<a href="javascript:history.go(-1);">
					<img th:src="@{/img/wx_ltone/icon/mine/fanhui.png}">
				</a>
			</div>
		</div>
		<div class="mdfd-content">
			<!--订单信息-->
			<img th:src="@{/img/wx_ltone/icon/mine/xuxian.png}">
			<div class="order-detail-box">
				<div class="order-detail order-details">
					<div class="payTitle">
						<div class="payTitle_left">
							<span>商品信息</span>
							<img th:src="@{/img/wx_ltone/icon/mine/titxian.png}">
						</div>
						<div class="payTitle_right">
							<img th:src="@{/img/wx_ltone/icon/mine/mianban.png}">
						</div>
						<div style="clear: both;"></div>
					</div>
					<div class="order-info order-infos">
						<div class="order-img order-imgs" >
							<img style="width: 100%;height: 100%;" id="store_pic" onerror="javascript:this.src='http://via.placeholder.com/100X100 '" src="http://via.placeholder.com/100X100 ">
						</div>
						<div class="default-text-color store-title" id="store_name"></div>
						<label style="display: block;opacity: 0;">商品数量：1件</label>
						<label style="display: block;" id="orderNo"></label>
					</div>

					<span class="float-r" id="true_price"></span>
				</div>
			</div>
			<div class="order-info order-infos">
				<span style="color: red" >*线下付款，请联系您的顾问！</span>
			</div>
			<div class="submit-add-idinfo-box">
				<div class="weui-btn weui-btn_primary btn" onclick="callpay()">微信支付</div>
			</div>
			<!-- <div class="payTitle_lb">
				<span>支持大额支付的</span>
				<label>《银行列表》 </label>
			</div> -->
		</div>
		<script src="../../static/js/wx_ltone/jquery-2.1.4.js" th:src="@{/js/wx_ltone/jquery-2.1.4.js}" ></script>
		<script src="../../static/js/wx_ltone/fastclick.js" th:src="@{/js/wx_ltone/fastclick.js}" ></script>
		<script src="../../static/js/wx_ltone/jquery-weui.js" th:src="@{/js/wx_ltone/jquery-weui.js}" ></script>
		<script src="../../static/js/wx_ltone/common.js" th:src="@{/js/wx_ltone/common.js}" ></script>
		<script src="../../static/js/basePathConfig.js" th:src="@{/js/basePathConfig.js}" ></script>
		
		<script>
			var truePrice = '[[${money}]]';
			var orderNo = '[[${orderNo}]]';
			var appId = '[[${appId}]]';
			var timeStamp = '[[${timeStamp}]]';
			var nonceStr = '[[${nonceStr}]]';
			var package = '[[${packageValue}]]';
			var paySign = '[[${paySign}]]';
			$(function() {
				FastClick.attach(document.body);
				
				var store_id = getUrlParam('store_id');
		      	$.ajax({ 
			    	type : "POST", //提交方式 
			     	url : basePath + '/wenxin_store/findStore',// 查询单个商品
			     	data : {
			     		store_id: store_id
			     	} ,//数据，这里使用的是Json格式进行传输 
			     	success : function(result) {
		      			$('#store_name').html('商品名称：' + result.data.store_name);
		      			$('#store_pic').attr('src',baseImgPath+result.data.store_picture.split(';')[0])
		      			$('#orderNo').html('订单号：' + orderNo);
		      			$('#true_price').html('应付金额：￥'+parseFloat(truePrice).toFixed(2));
			     	},
			     	error: function (err){
			     		$.toast("添加失败，请稍后重试...");
			     		return;
			     	}
			    });
		      	
			});
			
			function callpay(){
				WeixinJSBridge.invoke('getBrandWCPayRequest',{
  		 			"appId" : appId,
  		 			"timeStamp" : timeStamp, 
  		 			"nonceStr" : nonceStr, 
  		 			"package" : package,
  		 			"signType" : "MD5", 
  		 			"paySign" :  paySign
   				},function(res){
					WeixinJSBridge.log(res.err_msg);
	            	if(res.err_msg == "get_brand_wcpay_request:ok"){  
	                	$.toast("微信支付成功!");  
	                  	setTimeout(function(){//两秒后跳转  
                       		window.location.href= basePath + '/HomeController/mine';    
                		},20);
	            	}else if(res.err_msg == "get_brand_wcpay_request:cancel"){  
	                	$.toast("用户取消支付!");
	                	return;
	            	}else{  
	               		$.alert("支付失败!"+res.err_msg);
	               		return;
	            	}  
				}); 
			}
			
		</script>
	</body>
</html>
