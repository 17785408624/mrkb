<html xmlns:th="http://www.thymeleaf.org">
<head>
<div th:replace="common/common :: common_resource"></div>
    <meta charset="utf-8">
    <title>登陆</title>
</head>
<body>
<!--列表-->
<div id="vueContainer">
    <div v-show="showList">
    	<fieldset class="layui-elem-field site-demo-button" style="margin-top: 30px;">
		  <div>
		    <button class="layui-btn" @click="add"><i class="layui-icon layui-icon-add-1"></i>新增</button>
		  </div>
		</fieldset>
	    <table class="layui-table" lay-filter="test">
	        <thead>
	            <tr>
	                <th>ID</th>
	                <th>姓名</th>
	                <th>专业</th>
	                <th>地址</th>
	            </tr>
	        </thead>
	        <tbody>
	            <tr v-for="item in data">
	                <td>{{item.id}}</td>
	                <td>{{item.name}}</td>
	                <td>{{item.major}}</td>
	                <td>{{item.addrr}}</td>
	            </tr>
	        </tbody>
	    </table>
    	<!--分页容器-->
		<div id="pagination"></div>
    </div>
    <!-- 新增面板 -->
    <div v-show="!showList" class="layui-card">
    	<div class="layui-card-header">{{title}}</div>
    	<div class="layui-card-body">
    		<form class="layui-form">
			    <div class="layui-form-item">
				    <label class="layui-form-label">姓名</label>
			    	<div class="layui-input-block">
			        	<input type="text" name="name" required  lay-verify="required" v-model="vueTest.name" placeholder="请输入姓名" autocomplete="off" class="layui-input">
			    	</div>
			    </div>
			    <div class="layui-form-item">
				    <label class="layui-form-label">地址</label>
			    	<div class="layui-input-block">
			        	<input type="text" name="addrr" required  lay-verify="required" v-model="vueTest.addrr" placeholder="请输入地址" autocomplete="off" class="layui-input">
			    	</div>
			    </div>
			    <div class="layui-form-item">
				    <label class="layui-form-label">工作年限</label>
			    	<div class="layui-input-block">
			        	<input type="text" name="work_date" required  lay-verify="required" v-model="vueTest.work_date" placeholder="请输入工作年限" autocomplete="off" class="layui-input">
			    	</div>
			    </div>
			    <div class="layui-form-item">
		    	    <label class="layui-form-label">工作状态</label>
			        <div class="layui-input-block">
				       <select name="state" id="select_state" v-model="vueTest.state" lay-verify="required" lay-filter="select_state">
				         <option value=""></option>
				         <option value="0">正常</option>
				         <option value="1">离职</option>
				       </select>
			        </div>
			     </div>
		         <div class="layui-form-item">
				    <label class="layui-form-label">专业</label>
			    	<div class="layui-input-block">
			        	<input type="text" name="major" required  lay-verify="required" v-model="vueTest.major" placeholder="请输入专业" autocomplete="off" class="layui-input">
			    	</div>
			      </div>
				  <div class="layui-form-item">
				     <div class="layui-input-block">
				       <button class="layui-btn layui-btn-primary" @click="save"><i class="layui-icon layui-icon-ok"></i>提交</button>
				       <button type="reset" class="layui-btn layui-btn-primary"><i class="layui-icon layui-icon-refresh-3"></i>重置</button>
				       <button class="layui-btn layui-btn-primary" @click="reload"><i class="layui-icon layui-icon-return"></i>返回</button> 
				     </div>
				  </div>
			</form>
	    </div>
    </div>
</div>
<script type="text/javascript">
var vue = new Vue({
    el: "#vueContainer",
    data: {
        data: null,
        showList: true,
        title: null,
        vueTest: {},
    },
    methods: {
    	add: function () {
            vue.vueTest = {};
            vue.showList = false;
            vue.title = "新增";
            //初始化输入框或者选择框
            vue.vueTest = {
            	//例如
            	status: 1,
                work_date: 2,
            };
        },
        save:function(){
	        var tt = $("#select_state").val();
	        vue.vueTest.state=tt;
        	$.ajax({
                type: "POST",
                url: basePath+"/vue/VueTestadd",
                contentType:'application/json',
                async:true,
                data: JSON.stringify(vue.vueTest),
                success: function (r) {
                    if (r.errorCode == 200) {
                       layer.msg(r.message);
                       vue.reload();
                    } else {
                        layer.msg(r.message);
                    }
                }
            });
        },
        reload: function (event) {
            vue.showList = true;
        }
    }
});
//使用layui分页
layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element', 'slider'], function(){
    var laydate = layui.laypage,
    layer = layui.layer, //弹层
    table = layui.table, //表格
    carousel = layui.carousel, //轮播
    upload = layui.upload, //上传
    element = layui.element, //元素操作
    slider = layui.slider, //滑块
    form = layui.form,
    laypage = layui.laypage
    laypage.render({
        elem: 'pagination'
        , count: totalCount
        , layout: ['count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip']
        , jump: function (obj, first) {
            //点击非第一页页码时的处理逻辑。比如这里调用了ajax方法，异步获取分页数据
            if (!first) {
                pagination(obj.curr, obj.limit);//第二个参数不能用变量pageSize，因为当切换每页大小的时候会出问题
            }
        },
        
    });
});
var pageIndex = 1;
var pageSize = 10;
var totalCount = 0;
pagination(pageIndex, pageSize);
function pagination(pageIndex, pageSize) {
    //查询条件
    var param = {
        pageIndex: pageIndex,
        pageSize: pageSize,
        //其它查询条件可在下面添加
    };
    $.ajax({
        type: 'POST',
        url: basePath+'/vue/VueTestlist/'+pageIndex+"/"+pageSize+"/c",
        dataType: 'json',
        data: param,
        async: false,//这里设置为同步执行，目的是等数据加载完再调用layui分页组件，不然分页组件拿不到totalCount的值
        success: function (data) {
            vue.data = data.data.list;
            totalCount = data.data.total;
        }
    });
};
</script>
</body>
</html>
