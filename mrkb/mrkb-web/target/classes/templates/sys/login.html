<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<div th:replace="common/common :: common_resource"></div>
<!-- <script src="../../static/js/sys_index.js" th:src="@{/js/sys_index.js}" ></script> -->
</head>
    <meta charset="utf-8">
    <title>登陆</title>
</head>
<style>
	.login_style{
		width: 100%;
		height: 100%;
		position: absolute;
		z-index: -100;
		overflow: hidden;
	    -webkit-filter: blur(8px);
        -moz-filter: blur(8px);
        -ms-filter: blur(8px);    
        filter: blur(8px); 
	}
	.login_style img{
		width: 100%;
		height: 100%;
	}

.container{
	 width: 420px;
	 height: 320px;
	 min-height: 320px;  
	 max-height: 320px;  
	 position: absolute;   
	 top: 0;  
	 left: 0;  
	 bottom: 0;  
	 right: 0;  
	 margin: auto;  
	 padding: 20px;  
	 z-index: 130;  
	 border-radius: 8px;  
	 background-color: #fff;  
	 box-shadow: 0 3px 18px rgba(100, 0, 0, .5); 
	 font-size: 16px;
  }
	.close{
		background-color: white;
		border: none;
		font-size: 18px;
		margin-left: 410px;
		margin-top: -10px;
	}
 
  	.layui-input{
  		border-radius: 5px;
  		width: 300px;
  		height: 40px;
  		font-size: 15px;
  	}
  	.layui-form-item{
  		margin-left: -20px;
  	}
	#logoid{ 
		margin-top: -16px;
 		 padding-left:150px; 
 		 padding-bottom: 15px;
	}
	.layui-btn{
		margin-left: -50px;
		border-radius: 5px;
      		width: 350px;
      		height: 40px;
      		font-size: 15px;
	}
	.verity{
		width: 120px;
	}
	.font-set{
		font-size: 13px;
		text-decoration: none; 
		margin-left: 120px;
	}
	a:hover{
	 text-decoration: underline; 
	}
	.swiper-container{
	 width: 450px;
	 height: 320px;
	 min-height: 320px;  
	 max-height: 320px;  
	 position: absolute;   
	 top: 0;  
	 left: 0;  
	 bottom: 0;  
	 right: 0;  
	 margin: auto;  
	 padding: 20px;  
	 z-index: 130;  
	}
</style>
<body>
	<div class="login_style">
		<img alt="" th:src="@{/img/back_ground.jpg}">
	</div>
  <!-- Swiper -->
  <div class="swiper-container">
    <div class="swiper-wrapper">
	    <div class="swiper-slide swiper-no-swiping">
	    	<div>
    			<div class="layui-form" id="userLogin_form" method="post">
   					<div class="container ani" swiper-animate-effect="zoomInDown" swiper-animate-duration="0.5s" swiper-animate-delay="0.6s">
   						<div class="layui-form-mid layui-word-aux ani" swiper-animate-effect="zoomInDown" swiper-animate-duration="0.5s" swiper-animate-delay="0.7s">
			   				<!--<h3>乐唐 </h3>	-->
			   			</div>
		  				<div class="layui-form-item ani" swiper-animate-effect="fadeInLeftBig" swiper-animate-duration="0.5s" swiper-animate-delay="1s">
		    				<label class="layui-form-label">用户名</label>
		    				<div class="layui-input-block">
		      					<input type="text" name="username" placeholder="请输入用户名" autocomplete="off" class="layui-input">
		    				</div>
		  				</div>
		  			    <div class="layui-form-item ani" swiper-animate-effect="fadeInRight" swiper-animate-duration="0.5s" swiper-animate-delay="1.1s">
		    				<label class="layui-form-label">密 &nbsp;&nbsp;码</label>
		    				<div class="layui-input-inline">
		      					<input type="password" name="password" placeholder="请输入密码" autocomplete="off" class="layui-input">
		    		   		</div>
	    				<!-- <div class="layui-form-mid layui-word-aux">辅助文字</div> -->
		  				</div>
		   			    <div class="layui-form-item ani layui-inline" swiper-animate-effect="flipInX" swiper-animate-duration="0.5s" swiper-animate-delay="1.3s">
		    				<label class="layui-form-label">验证码</label>
		    				<div class="layui-inline">
		      					<input type="text" name="vCode" placeholder="请输入验证码" autocomplete="off" class="layui-input verity">
		    				</div>
		    				<div class="layui-inline" style="cursor:pointer;" onclick="refreshCode()">
		    					<img id="picCode" alt="验证码" th:src="@{/kaptcha.jpg}" width="100" height="40">
		    				</div>
		  				</div>
	  					<div class="layui-form-item ani" swiper-animate-effect="lightSpeedIn" swiper-animate-duration="0.5s" swiper-animate-delay="1.5s">
			    			<label class="layui-form-label">记住我</label>
						    <div class="layui-input-block">
						      <input type="checkbox" name="rememberme" lay-skin="switch" lay-text="是|否">
						    </div>
		  				</div>
		  				<div class="layui-form-item ani" swiper-animate-effect="zoomIn" swiper-animate-duration="0.5s" swiper-animate-delay="1.7s">
		    				<div class="layui-input-block">
		       					<button onclick="userlogin()" class="layui-btn" lay-submit lay-filter="formDemo">登陆</button>	     
		    				</div>
		  				</div>
					</div>
				</div>
	    	</div>
	    </div>
   </div>
 </div>
  <!-- Initialize Swiper -->
  <script>
  layui.use(['laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element', 'slider'], function(){
	slider = layui.slider //滑块
  })
  
  
   document.onkeydown = function (event) {
        var e = event || window.event;
        if (e && e.keyCode == 13) { //回车键的键值为13
            userlogin();
        }
    };
    var mySwiper = new Swiper('.swiper-container',{
    noSwiping: true,
    on:{
      init: function(){
        swiperAnimateCache(this); //隐藏动画元素 
        this.emit('slideChangeTransitionEnd');//在初始化时触发一次slideChangeTransitionEnd事件
      }, 
      slideChangeTransitionEnd: function(){ 
        swiperAnimate(this); //每个slide切换结束时运行当前slide动画
		this.slides.eq(this.activeIndex).find('.ani').removeClass('ani');//动画只展示一次
      } 
    }
  });
	
	//刷新验证码
	function refreshCode(){
		$("#picCode").attr('src',basePath+'/kaptcha.jpg?' + Math.floor(Math.random() * 100));
	}
	//用户登录
	function userlogin(){
		var username=$("#userLogin_form input[name=username]").val();
		var password=$("#userLogin_form input[name=password]").val();
		var vCode=$("#userLogin_form input[name=vCode]").val();
		var rememberme=false;
		if($("#userLogin_form input[type='checkbox']").is(':checked')){
			rememberme=true;
		}
		if(username.length<=0){
			layer.alert('请填写用户名', {icon: 5});
			return;
		}
		if(password.length<=0){
			layer.alert('请填写密码', {icon: 5});
			return;
		}
		if(vCode.length<=0){
			layer.alert('请填写验证码', {icon: 5});
			return;
		}
		layer.load(2);
		$.ajax({
			url:basePath+"/user/loginUser",
			type:"post",
			data:{
				username : username,
				password : password,
				vCode : vCode,
				rememberme : rememberme
			},
			success:function(r){
				layer.closeAll('loading');
				layer.msg(r.message);
				if(r.errorCode==202){
					refreshCode();
					setTimeout(function(){
                        var storage=window.localStorage;//将用户账号传至下一个页面
                        storage.setItem("user_account_num",r.data.user_account_num);
					  	window.location.href =basePath+'/admin/mains';
					}, 800);
				}else{
					refreshCode();
				}
			},
			error:function(r){
				refreshCode();
				layer.closeAll('loading');
				layer.msg("登陆失败");
			}
		});
	}
  </script>
</body>
</html>
