<html xmlns:th="http://www.thymeleaf.org">
<head>
<div th:replace="common/common :: common_resource"></div>
<meta charset="utf-8">
<title>兑换到余额</title>
<style type="text/css">
.uploader-list {
	margin-left: -15px;
}

.uploader-list .info {
	position: relative;
	margin-top: -25px;
	background-color: black;
	color: white;
	filter: alpha(Opacity = 80);
	-moz-opacity: 0.5;
	opacity: 0.5;
	width: 100px;
	height: 25px;
	text-align: center;
	display: none;
}

.uploader-list .handle {
	position: relative;
	background-color: black;
	color: white;
	filter: alpha(Opacity = 80);
	-moz-opacity: 0.5;
	opacity: 0.5;
	width: 100px;
	text-align: right;
	height: 18px;
	margin-bottom: -18px;
	display: none;
}

.uploader-list .handle span {
	margin-right: 5px;
}

.uploader-list .handle span:hover {
	cursor: pointer;
}

.uploader-list .file-iteme {
	margin: 12px 0 0 15px;
	padding: 1px;
	float: left;
}
</style>
</head>
<body>
	<!--列表-->
	<div id="vueContainer">
		<div v-show="showList">
			<fieldset class="layui-elem-field site-demo-button"
				style="margin-top: 30px;">
			</fieldset>
			<table class="layui-table" lay-filter="test">
				<thead>
					<tr>
						<th>申请兑换编号</th>
						<th>申请时间</th>
						<th>申请金额</th>
						<th>用户编号</th>
						<th>收款人姓名</th>
						<th>申请状态</th>
						<th>备注</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody>
					<tr v-for="item in data">
						<td>{{item.bonus_extract_apply_id}}</td>
						<td>{{formatDateTimeStr(item.apply_add_date,1)}}</td>
						<td>{{item.apply_sum}}</td>
						<td>{{item.user_basics_id}}</td>
						<td>{{item.receive_name}}</td>
						<td>{{exchangestatus(item.apply_status)}}</td>
						<td>{{item.apply_postscript}}</td>
						<td><a v-if="item.apply_status==1" class="layui-btn layui-btn-xs" lay-event="pass" 
							@click='pass(item.bonus_extract_apply_id)'>通过</a> <a  v-if="item.apply_status==1"
							class="layui-btn layui-btn-danger layui-btn-xs" lay-event="stop"
							@click='stop(item.bonus_extract_apply_id)'>拒绝</a></td>
					</tr>
				</tbody>
			</table>
			<!--分页容器-->
			<div id="pagination"></div>
		</div>
	</div>
	<script type="text/javascript">
		
		var active = {};
		var vue = new Vue({
			el : "#vueContainer",
			data : {
				data : null,
				showList : true,
				title : null,
				news : {},
			},
			methods : {
				add : function() {
					vue.news = {};
					vue.showList = false;
					vue.title = "查询";
					//初始化输入框或者选择框
					vue.news = {
						//例如
						/* course_type : 0, //将value值初始化
						academic_type : 0, //将value值初始化
						user_grade_id : 0, //将value值初始化
						store_type : 0 //将value值初始化 */
					};
				},
				//通过
				pass : function(id) {
					//alert(11);
					vue.news = {};
					vue.showList = false;
					vue.title = "同意申请";
					//下拉框查询
					//this.getselectoptions();
					$.ajax({
						type : "GET",
						url : basePath + "/admin_bonus/updatebonusstate3/" + id,
						async : true,
						success : function(r) {
							if(r.data>0){
								alert("通过成功!");
							}
							
						},
						error : function(r) {
							alert("通过失败!");
							//layer.msg(r.data.message);
						}
					});
				},
				//拒绝
				stop : function(id) {
					$.get(basePath + "/admin_bonus/updatebonusstate8/" + id, function(data) {
						if (data.data) {
							layer.confirm('确定拒绝？', {
								btn : [ '确定', '取消' ] //按钮
							}, function() {
								$.get(basePath + "/admin_bonus/updatebonusstate8/" + id, function(data) {
									layer.msg(data.message);
								//this.reload();
								});
							}, function() {
								layer.msg('取消操作', {
									icon : 2
								});
							});
						} else {
							layer.confirm('确定拒绝？', {
								btn : [ '确定', '取消' ] //按钮
							}, function() {
								$.get(basePath + "/admin_bonus/updatebonusstate8/" + id, function(data) {
									layer.msg(data.message);
								//this.reload();
								});
							}, function() {
								layer.msg('取消操作', {
									icon : 2
								});
							});
						}
					});
				},
	
				reload : function(event) {
					vue.showList = true;
				}
			}
		});
		layui.use([ 'laydate', 'laypage', 'layer', 'table', 'carousel', 'upload', 'element', 'slider', 'form',], function() {
			var laydate = layui.laypage,
				layer = layui.layer, //弹层
				table = layui.table, //表格
				carousel = layui.carousel, //轮播
				upload = layui.upload, //上传
				element = layui.element, //元素操作
				slider = layui.slider, //滑块
				form = layui.form,
				laypage = layui.laypage,
				$ = layui.jquery;
			laypage.render({
				elem : 'pagination',
				count : totalCount,
				layout : [ 'count', 'prev', 'page', 'next', 'limit', 'refresh', 'skip' ],
				jump : function(obj, first) {
					//点击非第一页页码时的处理逻辑。比如这里调用了ajax方法，异步获取分页数据
					if (!first) {
						pagination(obj.curr, obj.limit); //第二个参数不能用变量pageSize，因为当切换每页大小的时候会出问题
					}
				},
			});
	
		});
		
		//使用layui分页
		var pageIndex = 1;
		var pageSize = 10;
		var totalCount = 0;
		pagination(pageIndex, pageSize);
		function pagination(pageIndex, pageSize, name) {
			//查询条件
			var param = {
				pageIndex : pageIndex,
				pageSize : pageSize,
				name : name,
				state : 1
			//其它查询条件可在下面添加
			};
			$.ajax({
				type : 'POST',
				url : basePath + '/admin_bonus/adminFindIntegr/',
				dataType : 'json',
				data : param,
				async : false, //这里设置为同步执行，目的是等数据加载完再调用layui分页组件，不然分页组件拿不到totalCount的值
				success : function(data) {
					vue.data = data.data.list;
					totalCount = data.data.total;
				}
			});
		};
		//申请状态
		function exchangestatus(status) {
			if (status == 1) {
				return "待审核";
			} else if (status == 2) {
				return "已拒绝";
			} else if (status == 3) {
				return "已通过";
			}
	
		}
		//鼠标悬浮提示
		$(document).on("mouseenter mouseleave", ".file-iteme", function(event) {
			if (event.type === "mouseenter") {
				//鼠标悬浮
				$(this).children(".info").fadeIn("fast");
				$(this).children(".handle").fadeIn("fast");
			} else if (event.type === "mouseleave") {
				//鼠标离开
				$(this).children(".info").hide();
				$(this).children(".handle").hide();
			}
		});
	
		// 删除图片
		$(document).on("click", ".file-iteme .handle", function(event) {
			$(this).parent().remove();
		});
	</script>


</body>
</html>
