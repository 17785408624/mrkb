<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mrkb.dao.dao.UserAchievementMapper" >
<insert id="addUserAchievement" parameterType="com.mrkb.dao.modle.user.UserAchievement" useGeneratedKeys="true" keyProperty="achievement_id">
       insert into medicinefood.user_achievement 
		(
          user_basics_id
          ,team_num
          ,direct_team_num
          ,records_integral
          ,records_bonus
          ,team_consume
          ,direct_team_consume
          ,two_team_num
          ,three_team_num
          ,conver_num
          ,co_total_sale
          ,integral_no_active
          ,integrals_no_active
		) 
		value (
          #{user_basics_id,jdbcType=INTEGER}
          ,#{team_num,jdbcType=INTEGER}
          ,#{direct_team_num,jdbcType=INTEGER}
          ,#{records_integral,jdbcType=INTEGER}
          ,#{records_bonus,jdbcType=INTEGER}
          ,#{team_consume,jdbcType=INTEGER}
          ,#{direct_team_consume,jdbcType=INTEGER}
          ,#{two_team_num,jdbcType=INTEGER}
          ,#{three_team_num,jdbcType=INTEGER}
          ,#{conver_num,jdbcType=INTEGER}
          ,#{co_total_sale,jdbcType=INTEGER}
          ,#{integral_no_active,jdbcType=INTEGER}
          ,#{integrals_no_active,jdbcType=INTEGER}
		);
</insert>
<select id="findUserAchievementAll" parameterType="int" resultType="com.mrkb.dao.modle.user.UserAchievement">
SELECT a.*,b.user_money FROM user_achievement a
left join user_basics b on a.user_basics_id=b.user_basics_id
WHERE a.user_basics_id=#{user_basics_id,jdbcType=INTEGER}
</select>
<select id="findUserAchievementAccount" parameterType="int" resultType="com.mrkb.dao.modle.user.UserAchievementAccount">
SELECT user_basics_id,achievement_cutom_id,status  FROM user_achievement_custom 
WHERE user_basics_id=#{user_basics_id,jdbcType=INTEGER}
</select>
<update id="augmentUserAchievement" parameterType="com.mrkb.dao.modle.user.UserAchievement">
UPDATE user_achievement SET 
         <!-- 团队人数，暂不确定团队具体为几级之内--> 
          user_basics_id=#{user_basics_id,jdbcType=INTEGER}
          <if test="team_num!=null">
          ,team_num=team_num + #{team_num,jdbcType=INTEGER}
          </if>
          <if test="direct_team_num!=null and direct_team_num!=0">
          ,direct_team_num=direct_team_num + #{direct_team_num,jdbcType=INTEGER}
          </if>
          <if test="records_integral!=null and records_integral!=0">
          ,records_integral=records_integral + #{records_integral,jdbcType=INTEGER}
          </if>
          <if test="records_bonus!=null and records_bonus!=0">
          ,records_bonus=records_bonus + #{records_bonus,jdbcType=INTEGER}
          </if>
         <!-- 团队消费，暂不确定团队具体为几级之内 -->
          <if test="team_consume!=null and team_consume!=0">
          ,team_consume=team_consume + #{team_consume,jdbcType=INTEGER}
          </if>
          <if test="direct_team_consume!=null and direct_team_consume!=0">
          ,direct_team_consume= direct_team_consume+ #{direct_team_consume,jdbcType=INTEGER}
          </if>
          <if test="co_total_sale!=null and co_total_sale!=0.00">
          ,co_total_sale= co_total_sale+ #{co_total_sale,jdbcType=INTEGER} 
          </if>
    WHERE 1=1 and user_basics_id=#{user_basics_id,jdbcType=INTEGER}
</update>
<select id="findUserAchievement" resultType="com.mrkb.dao.modle.user.UserAchievement">
SELECT  ${listName} FROM user_achievement WHERE 1=1 and user_basics_id=#{user_basics_id,jdbcType=INTEGER}

</select>
<update id="updateArchivement"  parameterType="java.util.HashMap">
UPDATE user_achievement 
SET 
records_bonus=records_bonus+(#{records_bonus,jdbcType=DOUBLE}) 
WHERE 1=1
and user_basics_id=#{user_basics_id,jdbcType=INTEGER};
</update>
<update id="updateArchivement1"  parameterType="java.util.HashMap">
UPDATE user_achievement 
SET
    user_basics_id=#{user_basics_id,jdbcType=INTEGER}
<if test="records_integral!=null">
    ,records_integral=records_integral+(#{records_integral,jdbcType=INTEGER})
</if>
    <if test="integral_no_active!=null">
,integral_no_active=integral_no_active+(#{integral_no_active,jdbcType=INTEGER}) 
</if>
<if test="integrals_no_active!=null">
,integrals_no_active=integrals_no_active+(#{integrals_no_active,jdbcType=INTEGER}) 
</if>
<if test="conver_num!=null">
,conver_num=conver_num+(#{conver_num,jdbcType=INTEGER}) 
</if>
WHERE 1=1
and user_basics_id=#{user_basics_id,jdbcType=INTEGER}
</update>
<update id="updateArchivementAll" parameterType="java.util.List">
        <foreach collection="list" item="bean" index="index" open="" close="" separator=";">
            UPDATE user_achievement set
            	<trim suffixOverrides="," >
            		<if test="bean.team_num!=null">
            		team_num=team_num + #{bean.team_num,jdbcType=INTEGER},
            		</if>
            		<if test="bean.direct_team_num!=null">
          			direct_team_num=direct_team_num + #{bean.direct_team_num,jdbcType=INTEGER},
          			</if>
          			<if test="bean.records_integral!=null">
          			records_integral=records_integral + #{bean.records_integral,jdbcType=INTEGER},
         			</if>
          			<if test="bean.records_bonus!=null">
          			records_bonus=records_bonus + #{bean.records_bonus,jdbcType=INTEGER},
         			</if>
          			<if test="bean.co_total_sale!=null">
          			co_total_sale= co_total_sale+ #{bean.co_total_sale,jdbcType=INTEGER} ,
          			</if>
          			<if test="bean.two_team_num!=null">
          			two_team_num= two_team_num+ #{bean.two_team_num,jdbcType=INTEGER} ,
          			</if>
          			<if test="bean.three_team_num!=null">
          			three_team_num= three_team_num+ #{bean.three_team_num,jdbcType=INTEGER} 
          			</if>
            	</trim>
               where user_basics_id = #{bean.user_basics_id,jdbcType=INTEGER}
        </foreach>
</update>

</mapper>