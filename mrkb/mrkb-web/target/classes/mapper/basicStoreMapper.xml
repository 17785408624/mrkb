<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mrkb.dao.dao.BasicStoreMapper">

	<select id="findStoreBasics" resultType="com.mrkb.dao.modle.store.StoreBasics"
			parameterType="com.mrkb.dao.modle.store.StoreBasics">
		select * from store_basics where 1=1
		and store_id = #{store_id,jdbcType=INTEGER};
	</select>
	<select id="findCountStore" resultType="int" parameterType="java.util.HashMap">
		select count(*) from store_basics where status_state=0
		<if test="store_type!=null">
			and store_type=#{store_type,jdbcType=INTEGER};
		</if>
	</select>
	<select id="findAllStoreBasics" resultType="com.mrkb.dao.modle.store.StoreBasics"
			parameterType="com.mrkb.dao.modle.store.StoreBasics">
		select * from store_basics where 1=1
		<if test="store_type!=null"> and store_type=#{store_type,jdbcType=INTEGER}</if>
		<if test="status_state!=null"> and status_state=#{status_state,jdbcType=INTEGER} </if>
		<if test="academic_type!=null"> and academic_type=#{academic_type,jdbcType=INTEGER}</if>
		<if test="course_type!=null"> and course_type=#{course_type,jdbcType=INTEGER}</if>
		<if test="shelf_state!=null"> and shelf_state=#{shelf_state,jdbcType=INTEGER}</if>
		<!-- <if test="is_gift==2"> and is_gift=2</if> -->
		<if test="store_name != null and store_name != ''">
			and `store_name` like concat('%',#{store_name},'%')
		</if>
		ORDER BY store_id DESC
	</select>

	<select id="findAllStore" resultType="com.mrkb.dao.modle.store.StoreBasics"
			parameterType="com.mrkb.dao.modle.store.StoreBasics">
		select * from store_basics where 1=1
		<if test="status_state!=null"> and status_state=#{status_state,jdbcType=INTEGER} </if>
		<if test="store_name != null and store_name != ''">
			and `store_name` like concat('%',#{store_name},'%')
		</if>
		<if test="shelf_state != null and shelf_state!=0">
			and `shelf_state` like concat('%',#{shelf_state},'%')
		</if>
		ORDER BY store_id DESC
	</select>

	<select id="findStoreBasicsByPage" resultType="com.mrkb.dao.modle.store.StoreBasics"
			parameterType="java.util.HashMap">
		select * from store_basics
		where status_state=0
		<if test="store_type!=null">
			and store_type=#{store_type,jdbcType=INTEGER}
		</if>
		order by add_date desc
		<!-- limit #{begin_page,jdbcType=INTEGER},10; -->
	</select>

	<insert id="addStore" parameterType="com.mrkb.dao.modle.store.StoreBasics"
			useGeneratedKeys="true" keyProperty="store_id">
		insert into store_basics
		(business_id,store_price,store_picture,store_intro,user_basics_id,add_date,store_name,store_type,store_service,status_state,tutor_name,class_hour,tutor_num,academic_type,course_type,store_unit,other_price,user_grade_id,is_letang,is_integralBean,shelf_state,profit_monry)
		value (#{business_id,jdbcType=INTEGER}
		,#{store_price,jdbcType=DOUBLE}
		,#{store_picture,jdbcType=VARCHAR}
		,#{store_intro,jdbcType=VARCHAR}
		,#{user_basics_id,jdbcType=INTEGER}
		,#{add_date,jdbcType=BIGINT}
		,#{store_name,jdbcType=VARCHAR}
		,#{store_type,jdbcType=VARCHAR}
		,#{store_service,jdbcType=VARCHAR}
		,1
		,#{tutor_name,jdbcType=VARCHAR}
		,#{class_hour,jdbcType=VARCHAR}
		,#{tutor_num,jdbcType=INTEGER}
		,#{academic_type,jdbcType=INTEGER}
		,#{course_type,jdbcType=INTEGER}
		,#{store_unit,jdbcType=VARCHAR}
		,#{other_price,jdbcType=DOUBLE}
		,#{user_grade_id,jdbcType=INTEGER}
		,#{is_letang,jdbcType=INTEGER}
		,#{is_integralBean,jdbcType=INTEGER}
		,1
        ,#{profit_monry,jdbcType=DOUBLE}
		)
	</insert>
	<insert id="addStoreGift" parameterType="java.util.List">
		insert into store_gift (store_id,gift_name,store_ids,ids_num)
		values
		<foreach collection="list" item="emp" separator=",">
			(
			#{emp.store_id,jdbcType=VARCHAR}
			,#{emp.gift_name,jdbcType=VARCHAR}
			,#{emp.store_ids,jdbcType=VARCHAR}
			,#{emp.ids_num,jdbcType=INTEGER}
			)
		</foreach>
	</insert>
	<select id="findStoreGift" resultType="com.mrkb.dao.modle.store.StoreGift"
			parameterType="com.mrkb.dao.modle.store.StoreGift">
		select gift_id,store_id,gift_name,store_ids,ids_num from store_gift a where 1=1
		<if test="store_id!=null">
			and store_id=#{store_id,jdbcType=INTEGER}
		</if>
	</select>
	<update id="deleteStore" parameterType="java.util.HashMap">
		update store_basics set
		status_state=3 where store_id=#{store_id,jdbcType=INTEGER};
	</update>
	<select id="findPersonalStoreBasics" resultType="com.mrkb.dao.modle.store.StoreBasics"
			parameterType="String">
		select * from store_basics where 1=1
		and status_state=0
		and store_type=1
		order by store_id desc;
	</select>
	<update id="updateStore" parameterType="com.mrkb.dao.modle.store.StoreBasics">
		update store_basics set
		store_name=#{store_name,jdbcType=VARCHAR}
		,store_price=#{store_price,jdbcType=DOUBLE}
		,store_intro=#{store_intro,jdbcType=VARCHAR}
		,store_unit=#{store_unit,jdbcType=VARCHAR}
		,other_price=#{other_price,jdbcType=DOUBLE}
		where
		store_id=#{store_id,jdbcType=INTEGER};
	</update>
	<update id="updateStoreByStatus" parameterType="com.mrkb.dao.modle.store.StoreBasics">
		update
		store_basics set status_state=#{status_state,jdbcType=INTEGER}
		where
		store_id=#{store_id,jdbcType=INTEGER};
	</update>
	<!-- 根据审核状态状态为0查询商品信息 -->
	<select id="findStoreByState" resultType="com.mrkb.dao.modle.store.StoreBasics"
			parameterType="com.mrkb.dao.modle.store.StoreBasics">
		select * from store_basics where 1=1
		<if test="status_state!=null">
			and status_state=#{status_state,jdbcType=INTEGER}
		</if>

	</select>
	<!-- 根据审核状态状态为1查询商品详情 -->
	<select id="findStoreByOne" resultType="com.mrkb.dao.modle.store.StoreBasics"
			parameterType="com.mrkb.dao.modle.store.StoreBasics">
		select * from store_basics where 1=1
		<if test="status_state!=null">
			and status_state=#{status_state,jdbcType=INTEGER}
		</if>
		and store_id=#{store_id,jdbcType=INTEGER};
	</select>
	<!-- 查询用户是否购满乐唐大学课程 -->
	<select id="findLetang" resultType="int">
		select count(*) from
		store_basics where 1=1
		and is_letang=1
	</select>
	<delete id="deleteStores" parameterType="int">
		delete from store_basics
		where 1=1 and
		store_id=#{store_id,jdbcType=INTEGER};
	</delete>
	<!-- 单个套餐内容查询 -->
	<select id="findStoreGiftById" resultType="com.mrkb.dao.modle.store.StoreGift"
			parameterType="com.mrkb.dao.modle.store.StoreGift">
		select gift_id,store_id,gift_name,store_ids,ids_num from store_gift where 1=1
		<!-- <if test="store_id!=null">
		and store_id=#{store_id,jdbcType=INTEGER}
		</if> -->
		<if test="gift_id!=null">
			and gift_id=#{gift_id,jdbcType=INTEGER}
		</if>
	</select>
	<!--根据多ids查询课程信息表  -->
	<select id="findStoreByArrayIds" resultType="com.mrkb.dao.modle.store.StoreBasics">
		SELECT
		*
		FROM store_basics
		WHERE 1=1 and store_id IN
		<foreach collection="store_ids" index="index" item="storeIds" open="(" separator="," close=")">
			#{storeIds,jdbcType=INTEGER}
		</foreach>
	</select>
	<!--  根据是否下架状态更新-->
	<update id="updateStoreShelfState" parameterType="com.mrkb.dao.modle.store.StoreBasics">
		update
		store_basics set
		<trim suffixOverrides=",">
			<if test="shelf_state!=null">
				shelf_state=#{shelf_state,jdbcType=INTEGER}
			</if>
			<if test="status_state!=null">
				,status_state=#{status_state,jdbcType=INTEGER}
			</if>
		</trim>
		where
		store_id=#{store_id,jdbcType=INTEGER};
	</update>

</mapper>